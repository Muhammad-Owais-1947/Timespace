<!DOCTYPE html>
<!-- 'scroll-smooth' enables smooth scrolling for anchor links -->
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!--  SEO: Title Tag -->
    <title>Time Space | Upload & Organize Your Schedule</title>

    <!--  favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='%233b82f6'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C6.095 4.01 5.25 4.973 5.25 6.108V18.75c0 1.243.87 2.25 1.976 2.25h4.272a2.25 2.25 0 002.25-2.25V5.117A2.25 2.25 0 0011.25 3H9.75a2.25 2.25 0 00-2.25 2.25z' /%3E%3C/svg%3E">
    
    <!-- SEO: Meta Tags -->
    <meta name="description" content="Instantly analyze and organize your school or work timetable. Upload any PDF, image, CSV, or Excel file and our AI will create a beautiful, interactive schedule for you.">
    <meta name="keywords" content="timetable analyzer, schedule maker, class schedule, work schedule, AI schedule, timetable generator, upload schedule, timetable PDF">

    <!-- SEO: Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://example.com/"> <!-- âœï¸ EDIT: Change this to your live URL -->
    <meta property="og:title" content="AI Timetable Analyzer | Upload & Organize Your Schedule">
    <meta property="og:description" content="Instantly analyze and organize your school or work timetable. Upload any PDF, image, CSV, or Excel file and our AI will create a beautiful, interactive schedule for you.">
    <meta property="og:image" content="https://placehold.co/1200x630/3b82f6/ffffff?text=AI+Timetable+Analyzer"> <!-- âœï¸ EDIT: Change to a link of a preview image -->
    
    <!-- SEO: Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://example.com/"> <!-- âœï¸ EDIT: Change this to your live URL -->
    <meta property="twitter:title" content="AI Timetable Analyzer | Upload & Organize Your Schedule">
    <meta property="twitter:description" content="Instantly analyze and organize your school or work timetable. Upload any PDF, image, CSV, or Excel file and our AI will create a beautiful, interactive schedule for you.">
    <meta property="twitter:image" content="https://placehold.co/1200x630/3b82f6/ffffff?text=AI+Timetable+Analyzer"> <!-- âœï¸ EDIT: Change to a link of a preview image -->

    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS Configuration
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- JS Libraries for functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <!-- Main Stylesheet -->
    <style>
        /* Base body styles for font and anti-aliasing */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* --- VIBRANT DAY-SPECIFIC COLORS --- */
        .day-section.day-mon { background-color: #dcfce7; } .dark .day-section.day-mon { background-color: #164e32; }
        .day-section.day-tue { background-color: #dbeafe; } .dark .day-section.day-tue { background-color: #1e3a8a; }
        .day-section.day-wed { background-color: #fee2e2; } .dark .day-section.day-wed { background-color: #7f1d1d; }
        .day-section.day-thu { background-color: #cffafe; } .dark .day-section.day-thu { background-color: #164e63; }
        .day-section.day-fri { background-color: #ede9fe; } .dark .day-section.day-fri { background-color: #4c1d95; }
        .day-section.day-sat { background-color: #ffedd5; } .dark .day-section.day-sat { background-color: #7c2d12; }
        .day-section.day-sun { background-color: #fce7f3; } .dark .day-section.day-sun { background-color: #831843; }

        /* VIBRANT TABLE ROW COLORS */
        #schedule-table tr.day-mon { background-color: #f0fdf4; border-left: 3px solid #4ade80; } .dark #schedule-table tr.day-mon { background-color: #164e3233; }
        #schedule-table tr.day-tue { background-color: #eff6ff; border-left: 3px solid #60a5fa; } .dark #schedule-table tr.day-tue { background-color: #1e3a8a33; }
        #schedule-table tr.day-wed { background-color: #fef2f2; border-left: 3px solid #f87171; } .dark #schedule-table tr.day-wed { background-color: #7f1d1d33; }
        #schedule-table tr.day-thu { background-color: #ecfeff; border-left: 3px solid #22d3ee; } .dark #schedule-table tr.day-thu { background-color: #164e6333; }
        #schedule-table tr.day-fri { background-color: #faf5ff; border-left: 3px solid #a78bfa; } .dark #schedule-table tr.day-fri { background-color: #4c1d9533; }
        #schedule-table tr.day-sat { background-color: #fff7ed; border-left: 3px solid #fb923c; } .dark #schedule-table tr.day-sat { background-color: #7c2d1233; }
        #schedule-table tr.day-sun { background-color: #fdf4ff; border-left: 3px solid #f472b6; } .dark #schedule-table tr.day-sun { background-color: #83184333; }
        
        /* Modern, clean card styling */
        .class-card { background-color: #ffffff; border: 1px solid #e5e7eb; transition: transform 0.2s ease, box-shadow 0.2s ease; cursor: grab; }
        .dark .class-card { background-color: #1f2937; border-color: #374151; }
        .class-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        .dark .class-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }

        .sortable-chosen { opacity: 0.7; transform: scale(1.02); }
        
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Modern table styling */
        #schedule-table { width: 100%; border-collapse: collapse; }
        #schedule-table th, #schedule-table td { padding: 1rem 1.25rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
        .dark #schedule-table th, .dark #schedule-table td { border-bottom-color: #374151; }
        #schedule-table th { background-color: #f9fafb; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #4b5563; }
        .dark #schedule-table th { background-color: #1f2937; color: #9ca3af; }
        #schedule-table tbody tr { transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out; }
        #schedule-table tbody tr:hover { transform: translateY(-2px); background-color: #f3f4f6; }
        .dark #schedule-table tbody tr:hover { background-color: #374151; }

        .class-card input { background-color: transparent; border: 0; border-bottom: 1px dashed #9ca3af; padding: 2px 0; width: 100%; transition: border-color 0.2s; }
        .class-card input:focus { outline: none; border-bottom: 1px solid #3b82f6; }

        .btn-animate { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.2s ease-in-out, filter 0.2s ease-in-out; }
        .btn-animate:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .dark .btn-animate:hover { box-shadow: 0 4px 14px rgba(0,0,0,0.25); }

        #report-issue-button { position: fixed; bottom: 2rem; right: 2rem; z-index: 1000; background-color: #ef4444; color: white; width: 3.5rem; height: 3.5rem; border-radius: 9999px; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 0 0 rgba(239, 68, 68, 1); animation: glow-red 2s infinite; }
        .dark #report-issue-button { background-color: #f87171; }
        
        @keyframes glow-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* Full-screen loader overlay */
        .loader-overlay {
            position: fixed;
            inset: 0;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: rgba(248, 250, 252, 0.8); /* slate-50 with opacity */
            backdrop-filter: blur(4px);
            transition: opacity 0.5s ease-in-out;
        }
        .dark .loader-overlay {
             background-color: rgba(15, 23, 42, 0.8); /* slate-900 with opacity */
        }
        .loader-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Improved loading animation */
        .loader-logo path {
            stroke-dasharray: 250; /* Estimated path length for the SVG */
            stroke-dashoffset: 250;
            animation: draw 2s ease-in-out infinite;
        }
        .loader-text {
            animation: pulse-text 2s ease-in-out infinite;
        }
        @keyframes draw {
            0% { stroke-dashoffset: 250; }
            50% { stroke-dashoffset: 0; }
            100% { stroke-dashoffset: -250; }
        }
        @keyframes pulse-text {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
    </style>
</head>

<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200">

<!-- Initial Page Loader -->
<div id="page-loader" class="loader-overlay">
    <svg class="loader-logo h-16 w-16 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C6.095 4.01 5.25 4.973 5.25 6.108V18.75c0 1.243.87 2.25 1.976 2.25h4.272a2.25 2.25 0 002.25-2.25V5.117A2.25 2.25 0 0011.25 3H9.75a2.25 2.25 0 00-2.25 2.25z" />
    </svg>
    <p class="loader-text text-blue-600 dark:text-blue-400 font-medium mt-4 text-lg">Loading Time Space...</p>
</div>

<!-- File Processing Loader -->
<div id="processing-loader" class="loader-overlay hidden">
     <svg class="loader-logo h-16 w-16 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C6.095 4.01 5.25 4.973 5.25 6.108V18.75c0 1.243.87 2.25 1.976 2.25h4.272a2.25 2.25 0 002.25-2.25V5.117A2.25 2.25 0 0011.25 3H9.75a2.25 2.25 0 00-2.25 2.25z" />
    </svg>
    <p class="loader-text text-blue-600 dark:text-blue-400 font-medium mt-4 text-lg">Making magic behind the scenes...</p>
</div>

<!-- Header -->
<header class="sticky top-0 z-50 w-full bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm border-b border-slate-200 dark:border-slate-800 transition-transform duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
            <!-- Logo/Site Title -->
            <a href="#" class="flex items-center space-x-2">
                <svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" role="img" aria-label="Timetable Icon">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C6.095 4.01 5.25 4.973 5.25 6.108V18.75c0 1.243.87 2.25 1.976 2.25h4.272a2.25 2.25 0 002.25-2.25V5.117A2.25 2.25 0 0011.25 3H9.75a2.25 2.25 0 00-2.25 2.25z" />
                </svg>
                <span class="font-bold text-lg sm:text-xl text-slate-900 dark:text-white">Time Space</span>
            </a>
            <!-- Navigation Links & Theme Toggle -->
            <div class="flex items-center space-x-2 sm:space-x-4">
                <nav class="hidden md:flex items-center space-x-4 text-sm font-medium text-slate-600 dark:text-slate-400">
                    <a href="#features" class="hover:text-blue-600 transition-colors">Features</a>
                    <a href="#portfolio" class="hover:text-blue-600 transition-colors">Portfolio</a>
                </nav>
                <div class="h-6 w-px bg-slate-200 dark:bg-slate-700 hidden md:block"></div>
                <!-- Theme Toggle Button -->
                <button id="theme-toggle" class="h-9 w-9 flex items-center justify-center rounded-lg text-slate-500 hover:bg-slate-200 dark:text-slate-400 dark:hover:bg-slate-800 transition-colors btn-animate">
                    <svg class="h-5 w-5 block dark:hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" role="img" aria-label="Moon Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" /></svg>
                    <svg class="h-5 w-5 hidden dark:block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" role="img" aria-label="Sun Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" /></svg>
                </button>
            </div>
        </div>
    </div>
</header>

<main>
    <!-- Hero Section -->
    <section class="text-center py-16 sm:py-24 px-4 sm:px-6 lg:px-8">
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold tracking-tight text-slate-900 dark:text-white">
            Intelligent Time Space Analysis
        </h1>
        <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600 dark:text-slate-400">
            Automatically extract, organize, and interact with your schedule. Just upload your timetable file to begin.
        </p>
        
        <!-- Main Application Block -->
        <div id="timetable-app" class="max-w-4xl mx-auto mt-12 bg-white dark:bg-slate-800 rounded-2xl shadow-lg overflow-hidden border border-slate-200 dark:border-slate-700 text-left">
            <!-- Upload Area -->
            <div id="upload-section" class="p-4 sm:p-6 border-b border-slate-200 dark:border-slate-700 flex flex-col items-center">
                 <button id="upload-button" class="btn-animate w-full max-w-xs px-6 py-3 text-base font-semibold bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 dark:hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800">
                    Upload Your Timetable
                </button>
                <input type="file" id="file-upload" accept="image/*,application/pdf,.csv,.xlsx" class="hidden"/>
                <p class="text-xs text-slate-500 dark:text-slate-400 mt-2">Max file size: 10MB. Supports PDF, PNG, JPG, CSV, XLSX.</p>
                <div id="status-message" class="mt-4 p-3 rounded-md text-sm text-center hidden w-full" role="alert"></div>
            </div>
            
            <!-- Controls Area -->
            <div id="controls-area" class="hidden">
                 <div class="p-4 sm:p-6 border-b border-slate-200 dark:border-slate-700">
                    <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                         <label class="text-base font-semibold text-slate-800 dark:text-slate-200 whitespace-nowrap">âœ¨The Magic Worked â€” Hereâ€™s Your Interactive Schedule!</label>
                        <div class="flex items-center gap-2">
                             <div class="flex-shrink-0 flex items-center space-x-2 bg-slate-100 dark:bg-slate-900 p-1 rounded-md">
                                <button id="view-card" class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors btn-animate">Card View</button>
                                <button id="view-table" class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors btn-animate">Table View</button>
                            </div>
                            <button id="clear-schedule" class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors btn-animate bg-red-100 text-red-700 hover:bg-red-200 dark:bg-red-900/50 dark:text-red-300 dark:hover:bg-red-900">Clear</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Results and Download Area -->
            <div id="results-area" class="bg-slate-50 dark:bg-slate-900/50 p-4 sm:p-6">
                <div id="schedule-container" class="space-y-6 hidden"></div>
                <div class="overflow-x-auto rounded-lg border border-slate-200 dark:border-slate-700">
                    <table id="schedule-table" class="hidden">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
                 <div id="download-options" class="mt-6 flex flex-wrap gap-3 hidden">
                    <button id="download-pdf" class="btn-animate px-4 py-2 text-sm font-medium bg-blue-600 text-white rounded-md shadow-sm hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600">Download PDF</button>
                    <button id="download-png" class="btn-animate px-4 py-2 text-sm font-medium bg-emerald-600 text-white rounded-md shadow-sm hover:bg-emerald-700 dark:bg-emerald-700 dark:hover:bg-emerald-600">Download PNG</button>
                    <button id="download-csv" class="btn-animate px-4 py-2 text-sm font-medium bg-slate-600 text-white rounded-md shadow-sm hover:bg-slate-700 dark:bg-slate-700 dark:hover:bg-slate-600">Download CSV</button>
                    <button id="download-xlsx" class="btn-animate px-4 py-2 text-sm font-medium bg-slate-600 text-white rounded-md shadow-sm hover:bg-slate-700 dark:bg-slate-700 dark:hover:bg-slate-600">Download XLSX</button>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-16 sm:py-24 bg-white dark:bg-slate-800">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white sm:text-4xl">Powerful Features, Simple Interface</h2>
                <p class="mt-4 text-lg text-slate-600 dark:text-slate-400">Everything you need to manage your schedule efficiently.</p>
            </div>
            <div class="mt-12 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center bg-blue-100 dark:bg-blue-900/50 rounded-lg text-blue-600 dark:text-blue-400">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" role="img" aria-label="Cloud Upload Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l-3 3m3-3l3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" /></svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Dynamic Data Extraction</h3>
                        <p class="mt-1 text-slate-600 dark:text-slate-400">Intelligently analyzes any timetable structure from images, PDFs, CSV, and Excel files.</p>
                    </div>
                </div>
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center bg-blue-100 dark:bg-blue-900/50 rounded-lg text-blue-600 dark:text-blue-400">
                         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" role="img" aria-label="Edit Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" /></svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Live Editing</h3>
                        <p class="mt-1 text-slate-600 dark:text-slate-400">Easily reorder and edit your schedule entries after uploading.</p>
                    </div>
                </div>
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center bg-blue-100 dark:bg-blue-900/50 rounded-lg text-blue-600 dark:text-blue-400">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" role="img" aria-label="Download Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Multiple Export Options</h3>
                        <p class="mt-1 text-slate-600 dark:text-slate-400">Download your timetable as a PDF, PNG, CSV, or XLSX file.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="py-16 sm:py-24">
        <div class="max-w-3xl mx-auto text-center px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white sm:text-4xl">Have a Look</h2>
            <p class="mt-4 text-lg text-slate-600 dark:text-slate-400">Interested in seeing more of my work? Visit my portfolio to explore other projects.</p>
            <div class="mt-8">
                <!-- âœï¸ EDIT: Change the link to your portfolio -->
                <a href="https://muhammad-owias.github.io/portfolio/" target="_blank" rel="noopener noreferrer" class="btn-animate inline-block px-8 py-3 text-base font-semibold bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 dark:hover:bg-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800">
                    Check Out What Iâ€™ve Built
                </a>
            </div>
        </div>
    </section>
</main>

<!-- Footer -->
<footer class="bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700">
    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500 dark:text-slate-400">
        <!-- âœï¸ EDIT: Change copyright year/text -->
        <p>&copy; 2025 Time Space. All rights reserved. Crafted with Code & Coffee â˜• â€” Muhammad Owais.</p>
    </div>
</footer>

<!-- ðŸ“§ EDIT: Change your email address in the link below -->
<!-- Floating "Report an Issue" Button -->
<a id="report-issue-button" 
   href="https://mail.google.com/mail/?view=cm&fs=1&to=nadeemowias267@gmail.com&su=Issue%20Report:%20AI%20Timetable%20Analyzer&body=Hello,%20I%20encountered%20an%20issue...%0D%0A%0D%0A[Please%20describe%20the%20issue%20and,%20if%20possible,%20attach%20the%20file%20you%20used.]%0D%0A" 
   target="_blank" rel="noopener noreferrer"
   class="btn-animate" 
   title="Report an Issue">
    <!-- SVG Icon -->
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" role="img" aria-label="Report Bug Icon">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
    </svg>
</a>

<script>
    // ===================================================================================
    // JAVASCRIPT LOGIC
    // ===================================================================================

    // --- AUTO-HIDING HEADER ---
    const header = document.querySelector('header');
    let lastScrollTop = 0;
    window.addEventListener('scroll', function() {
        let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        if (scrollTop > lastScrollTop && scrollTop > header.offsetHeight) {
            header.classList.add('-translate-y-full');
        } else {
            header.classList.remove('-translate-y-full');
        }
        lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
    });

    // --- THEME MANAGEMENT ---
    const themeToggle = document.getElementById('theme-toggle');
    if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    }
    themeToggle.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
    });

    // --- GLOBAL CONSTANTS AND STATE VARIABLES ---
    const GEMINI_API_KEY = "AIzaSyDjlcBaKGpKs03YoQn-tlZex5F9Wt9tFwQ"; // Placeholder for Gemini API Key
    const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${GEMINI_API_KEY}`;
    const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB

    const DAY_CLASSES = {
        'Monday': 'day-mon', 'Mon': 'day-mon', 'Tuesday': 'day-tue', 'Tue': 'day-tue', 'Wednesday': 'day-wed', 'Wed': 'day-wed',
        'Thursday': 'day-thu', 'Thu': 'day-thu', 'Friday': 'day-fri', 'Fri': 'day-fri', 'Saturday': 'day-sat', 'Sat': 'day-sat', 'Sunday': 'day-sun', 'Sun': 'day-sun'
    };
    const DAY_ORDER = ['Monday', 'Mon', 'Tuesday', 'Tue', 'Wednesday', 'Wed', 'Thursday', 'Thu', 'Friday', 'Fri', 'Saturday', 'Sat', 'Sunday', 'Sun'];

    const defaultTimetableData = [
        { day: "Monday", time: "03:30 PM - 04:45 PM", code: "IS230", name: "Emerging Technologies", faculty: "Anusha Gilani", room: "SST-101" },
        { day: "Monday", time: "02:00 PM - 03:15 PM", code: "IS240", name: "Management Information System", faculty: "Anusha Gilani", room: "2N-02" },
        { day: "Tuesday", time: "05:00 PM - 06:15 PM", code: "FN340", name: "Business Finance", faculty: "Dr. M Mahmood Shah Khan", room: "2N-03" },
        { day: "Tuesday", time: "03:30 PM - 04:45 PM", code: "MK210", name: "Principles of Marketing", faculty: "Dr. Abdul Waheed", room: "1C-15" },
        { day: "Wednesday", time: "08:00 AM - 09:15 AM", code: "IS360", name: "Data Communication and Networking", faculty: "Abdul Ghafar", room: "2N-12" },
        { day: "Wednesday", time: "09:30 AM - 10:45 AM", code: "IS360", name: "Data Communication and Networking", faculty: "Abdul Ghafar", room: "2N-12" },
        { day: "Thursday", time: "03:30 PM - 04:45 PM", code: "IS230", name: "Emerging Technologies", faculty: "Anusha Gilani", room: "SST-101" },
        { day: "Thursday", time: "02:00 PM - 03:15 PM", code: "IS240", name: "Management Information System", faculty: "Anusha Gilani", room: "2N-02" },
        { day: "Friday", time: "11:00 AM - 12:15 PM", code: "IS412", name: "IT Project Management", faculty: "Sana Amjad", room: "2N-12" },
        { day: "Friday", time: "05:00 PM - 06:15 PM", code: "FN340", name: "Business Finance", faculty: "Dr. M Mahmood Shah Khan", room: "2N-03" },
        { day: "Friday", time: "03:30 PM - 04:45 PM", code: "MK210", name: "Principles of Marketing", faculty: "Dr. Abdul Waheed", room: "1C-15" },
        { day: "Friday", time: "02:00 PM - 03:15 PM", code: "IS412", name: "IT Project Management", faculty: "Sana Amjad", room: "2N-12" }
    ];

    let timetableData = JSON.parse(JSON.stringify(defaultTimetableData));
    let timetableHeaders = [];
    let dayColumnKey = '';
    let currentView = 'card';
    let source = 'default';

    // --- DOM ELEMENT SELECTORS ---
    const pageLoader = document.getElementById('page-loader');
    const processingLoader = document.getElementById('processing-loader');
    const statusMessage = document.getElementById('status-message');
    const scheduleContainer = document.getElementById('schedule-container');
    const scheduleTable = document.getElementById('schedule-table');
    const controlsArea = document.getElementById('controls-area');
    const downloadOptions = document.getElementById('download-options');
    const fileUpload = document.getElementById('file-upload');
    const uploadButton = document.getElementById('upload-button');
    const viewCard = document.getElementById('view-card');
    const viewTable = document.getElementById('view-table');
    const clearScheduleBtn = document.getElementById('clear-schedule');

    // --- EVENT LISTENERS ---
    uploadButton.addEventListener('click', () => fileUpload.click());
    fileUpload.addEventListener('change', handleFileUpload);
    viewCard.addEventListener('click', () => switchView('card'));
    viewTable.addEventListener('click', () => switchView('table'));
    clearScheduleBtn.addEventListener('click', clearSchedule);
    document.getElementById('download-pdf').addEventListener('click', downloadAsPDF);
    document.getElementById('download-png').addEventListener('click', downloadAsPNG);
    document.getElementById('download-csv').addEventListener('click', downloadAsCSV);
    document.getElementById('download-xlsx').addEventListener('click', downloadAsXLSX);

    // --- INITIALIZATION ---
    window.addEventListener('load', () => {
        // Hide initial loader
        setTimeout(() => pageLoader.classList.add('hidden'), 250);

        renderTimetable(timetableData);
        controlsArea.classList.remove('hidden');
        downloadOptions.classList.remove('hidden');
        showStatus('Default schedule loaded. Upload a file to see the magic.', 'success');
    });

    // --- CORE FUNCTIONS ---
    function showStatus(message, type) {
        statusMessage.textContent = message;
        statusMessage.className = `mt-4 p-3 rounded-md text-sm text-center w-full ${type === 'error' ? 'bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300' : 'bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300'}`;
        statusMessage.classList.remove('hidden');
    }

    function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    }

    function getDayIndex(day) { return DAY_ORDER.indexOf(day) === -1 ? Infinity : DAY_ORDER.indexOf(day); }
    
    function findDayColumnKey(headers) {
        const dayKeywords = ['day', 'weekday', 'jour'];
        return headers.find(header => dayKeywords.includes(header.toLowerCase())) || '';
    }

    function clearSchedule() {
        timetableData = JSON.parse(JSON.stringify(defaultTimetableData));
        source = 'default';
        fileUpload.value = '';
        renderTimetable(timetableData);
        showStatus('Schedule cleared. Showing default timetable.', 'success');
    }
    
    // --- FILE PARSING AND HANDLING ---
    function structureParsedData(rawData) {
        if (rawData.length < 2) return [];
        const headers = rawData[0];
        const dataRows = rawData.slice(1);
        return dataRows.map(row => {
            const entry = {};
            headers.forEach((header, index) => {
                entry[header] = (row[index] || '').toString().trim();
            });
            return entry;
        }).filter(entry => Object.values(entry).some(val => val));
    }
    
    function parseCSV(file) {
        return new Promise((resolve, reject) => {
            Papa.parse(file, {
                complete: res => res.errors.length ? reject(res.errors[0]) : resolve(structureParsedData(res.data)),
                error: reject, skipEmptyLines: true
            });
        });
    }

    function parseXLSX(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = e => {
                try {
                    const workbook = XLSX.read(e.target.result, { type: 'binary' });
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    resolve(structureParsedData(XLSX.utils.sheet_to_json(worksheet, { header: 1 })));
                } catch (err) { reject(err); }
            };
            reader.onerror = reject;
            reader.readAsBinaryString(file);
        });
    }

    async function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        if (file.size > MAX_FILE_SIZE) return showStatus('File too large! Max size is 10MB.', 'error');
        
        const allowedTypes = ['image/png', 'image/jpeg', 'application/pdf', 'text/csv', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'];
        if (!allowedTypes.includes(file.type) && !file.name.endsWith('.csv')) return showStatus('Invalid file type! Supported: PDF, PNG, JPG, CSV, XLSX.', 'error');

        processingLoader.classList.remove('hidden');
        showStatus('File uploaded. Processing...', 'success');
        scheduleContainer.innerHTML = '';
        scheduleTable.querySelector('tbody').innerHTML = '';
        controlsArea.classList.add('hidden');
        downloadOptions.classList.add('hidden');
        timetableData = [];

        try {
            const fileExt = file.name.split('.').pop().toLowerCase();
            if (fileExt === 'csv') timetableData = await parseCSV(file);
            else if (fileExt === 'xlsx') timetableData = await parseXLSX(file);
            else if (['pdf', 'png', 'jpg', 'jpeg'].includes(fileExt)) {
                const fileData = await fileToBase64(file);
                await callGeminiAPI(file.type, fileData);
                return; // Gemini handles rendering and hiding loader
            } else throw new Error('Unsupported file type.');
            
            source = 'uploaded';
            renderTimetable(timetableData);
        } catch (error) {
            console.error('Processing error:', error);
            showStatus(`Error: ${error.message}. Please check the file format.`, 'error');
        } finally {
            // Only hide loader if not handled by Gemini
            if (!['pdf', 'png', 'jpg', 'jpeg'].includes(file.name.split('.').pop().toLowerCase())) {
                 processingLoader.classList.add('hidden');
            }
        }
    }

    async function callGeminiAPI(mimeType, fileData) {
        const systemPrompt = `Analyze the provided timetable image or document. Identify all distinct columns and their headers. Extract the schedule information into a JSON array of objects. Each object should represent a single row from the timetable. The keys of the objects must be the column headers you identified (e.g., "Time", "Course Name", "Room", etc.). Ensure data is clean and accurately structured. If a row is empty or a header, ignore it.`;
        const payload = {
            contents: [{ parts: [{ text: "Extract the data from this timetable." }, { inlineData: { mimeType: mimeType, data: fileData } }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
            generationConfig: { responseMimeType: "application/json" }
        };

        try {
            const response = await fetch(GEMINI_API_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`API error: ${response.status} - ${await response.text()}`);
            const result = await response.json();
            let jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;
            if (!jsonText) throw new Error("No valid content received from API.");
            
            jsonText = jsonText.replace(/^```json\s*|```$/g, '').trim();
            const parsedData = JSON.parse(jsonText);
            if (!Array.isArray(parsedData) || parsedData.length === 0) throw new Error("AI analysis resulted in empty or invalid data.");
            
            timetableData = parsedData;
            source = 'uploaded';
            renderTimetable(timetableData);
        } catch (error) {
            console.error('Gemini API Error:', error);
            showStatus(`AI analysis failed: ${error.message}`, 'error');
        } finally {
             processingLoader.classList.add('hidden');
        }
    }

    // --- UI RENDERING ---
    function renderTimetable(data) {
        controlsArea.classList.remove('hidden');
        downloadOptions.classList.remove('hidden');
        
        if (!data || data.length === 0) {
            scheduleContainer.innerHTML = '<p class="text-center text-slate-500 p-8">No schedule data to display.</p>';
            scheduleTable.parentElement.classList.add('hidden');
            scheduleContainer.classList.remove('hidden');
            return;
        }

        timetableHeaders = Object.keys(data[0]);
        dayColumnKey = findDayColumnKey(timetableHeaders);

        if (dayColumnKey) {
            data.sort((a, b) => getDayIndex(a[dayColumnKey]) - getDayIndex(b[dayColumnKey]));
        }
        
        timetableData = data;
        switchView(currentView);
    }
    
    function renderCardView() {
        scheduleContainer.innerHTML = '';
        scheduleContainer.classList.remove('hidden');
        scheduleTable.parentElement.classList.add('hidden');

        const groupedData = timetableData.reduce((acc, item) => {
            const key = dayColumnKey ? (item[dayColumnKey] || 'Uncategorized') : 'All Entries';
            (acc[key] = acc[key] || []).push(item);
            return acc;
        }, {});

        const sortedGroups = dayColumnKey ? Object.keys(groupedData).sort((a, b) => getDayIndex(a) - getDayIndex(b)) : ['All Entries'];

        sortedGroups.forEach((groupKey, index) => {
            const dayClass = DAY_CLASSES[groupKey] || '';
            const daySection = document.createElement('div');
            daySection.className = `day-section ${dayClass} p-4 rounded-lg fade-in`;
            daySection.style.animationDelay = `${index * 0.05}s`;
            
            let htmlContent = `<h3 class="text-xl font-bold text-slate-900 dark:text-white mb-3">${groupKey}</h3><div class="space-y-4 sortable" id="sortable-${groupKey.replace(/\s/g, '-')}">`;

            groupedData[groupKey].forEach((entry, entryIndex) => {
                let cardContent = '';
                timetableHeaders.forEach((header, i) => {
                    const value = entry[header] || 'N/A';
                    const isEditable = source !== 'default';
                    const displayValue = isEditable ? `<input type="text" data-key="${header}" value="${value}" class="w-full bg-transparent"/>` : `<span class="break-words">${value}</span>`;
                    
                    if (i < 2) cardContent += `<p class="font-semibold text-slate-900 dark:text-white capitalize">${header}: ${displayValue}</p>`;
                    else cardContent += `<p class="text-slate-500 dark:text-slate-400 capitalize text-sm">${header}: ${displayValue}</p>`;
                });

                htmlContent += `<div class="class-card p-4 rounded-lg" data-original-index="${entryIndex}"><div class="flex flex-col gap-1">${cardContent}</div></div>`;
            });

            htmlContent += `</div>`;
            daySection.innerHTML = htmlContent;
            scheduleContainer.appendChild(daySection);
            
            if (source !== 'default') {
                const sortableContainer = daySection.querySelector('.sortable');
                Sortable.create(sortableContainer, { animation: 150, onEnd: updateTimetableData });
                daySection.querySelectorAll('input').forEach(input => input.addEventListener('change', updateTimetableData));
            }
        });
    }

    function renderTableView() {
        const thead = scheduleTable.querySelector('thead');
        const tbody = scheduleTable.querySelector('tbody');
        thead.innerHTML = '';
        tbody.innerHTML = '';

        const headerRow = document.createElement('tr');
        timetableHeaders.forEach(header => { headerRow.innerHTML += `<th class="capitalize">${header}</th>`; });
        thead.appendChild(headerRow);
        
        scheduleTable.parentElement.classList.remove('hidden');
        scheduleTable.classList.remove('hidden');
        scheduleContainer.classList.add('hidden');

        timetableData.forEach(entry => {
            const row = document.createElement('tr');
            const dayValue = dayColumnKey ? entry[dayColumnKey] : null;
            row.className = `${DAY_CLASSES[dayValue] || ''} text-sm`;
            let rowHTML = '';
            timetableHeaders.forEach(header => { rowHTML += `<td class="whitespace-nowrap">${entry[header] || 'N/A'}</td>`; });
            row.innerHTML = rowHTML;
            tbody.appendChild(row);
        });
    }

    function switchView(view) {
        currentView = view;
        viewCard.classList.toggle('bg-blue-600', view === 'card'); viewCard.classList.toggle('text-white', view === 'card');
        viewCard.classList.toggle('text-slate-600', view !== 'card'); viewCard.classList.toggle('dark:text-slate-300', view !== 'card');
        viewTable.classList.toggle('bg-blue-600', view === 'table'); viewTable.classList.toggle('text-white', view === 'table');
        viewTable.classList.toggle('text-slate-600', view !== 'table'); viewTable.classList.toggle('dark:text-slate-300', view !== 'table');
        if (view === 'card') renderCardView(); else renderTableView();
    }

    function updateTimetableData() {
        if (source === 'default') return;
        const newData = [];
        scheduleContainer.querySelectorAll('.sortable').forEach(sortable => {
            sortable.querySelectorAll('.class-card').forEach(card => {
                const entry = {};
                card.querySelectorAll('input').forEach(input => { entry[input.dataset.key] = input.value; });
                newData.push(entry);
            });
        });
        timetableData = newData;
        showStatus('Changes saved!', 'success');
    }

    // --- EXPORT AND DOWNLOAD FUNCTIONS ---
    function createCaptureStylesheet(isDark) {
        const style = document.createElement('style');
        style.id = 'temp-capture-style';
        let css = `* { transition: none !important; animation: none !important; }`;
        if (isDark) {
            css += `
                .day-section.day-mon { background-color: #dcfce7 !important; } .day-section.day-tue { background-color: #dbeafe !important; }
                .day-section.day-wed { background-color: #fee2e2 !important; } .day-section.day-thu { background-color: #cffafe !important; }
                .day-section.day-fri { background-color: #ede9fe !important; } .day-section.day-sat { background-color: #ffedd5 !important; }
                .day-section.day-sun { background-color: #fce7f3 !important; }
                .day-section h3 { color: #1e293b !important; }
                .class-card { background-color: #ffffff !important; border-color: #e5e7eb !important; }
                .class-card p, .class-card span, .class-card input { color: #475569 !important; }
                .class-card .font-semibold, .class-card .font-semibold input { color: #1e293b !important; }
            `;
        }
        style.textContent = css;
        document.head.appendChild(style);
        return style;
    }

    async function captureFullElement(element) {
        const isDark = document.documentElement.classList.contains('dark');
        const tempStyleSheet = createCaptureStylesheet(isDark);
        await new Promise(resolve => requestAnimationFrame(resolve));
        try {
            return await html2canvas(element, { scale: 2, backgroundColor: '#f8fafc', useCORS: true });
        } finally {
            document.head.removeChild(tempStyleSheet);
        }
    }

    async function downloadAsPDF() {
        const { jsPDF } = window.jspdf;
        const element = currentView === 'card' ? scheduleContainer : scheduleTable.parentElement;
        if (!element) return;
        showStatus('Preparing PDF...', 'success');
        try {
            const canvas = await captureFullElement(element);
            const imgData = canvas.toDataURL('image/png');
            const { width, height } = canvas;
            const pdf = new jsPDF({ orientation: width > height ? 'l' : 'p', unit: 'px', format: [width, height] });
            pdf.addImage(imgData, 'PNG', 0, 0, width, height);
            pdf.save('timetable.pdf');
        } catch (error) {
            console.error("PDF Export failed:", error);
            showStatus('Failed to export PDF. Please try again.', 'error');
        }
    }

    async function downloadAsPNG() {
        const element = currentView === 'card' ? scheduleContainer : scheduleTable.parentElement;
        if (!element) return;
        showStatus('Preparing PNG...', 'success');
        try {
            const canvas = await captureFullElement(element);
            const link = document.createElement('a');
            link.download = 'timetable.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        } catch (error) {
            console.error("PNG Export failed:", error);
            showStatus('Failed to export PNG. Please try again.', 'error');
        }
    }

    function downloadAsCSV() {
        const csv = Papa.unparse(timetableData);
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = 'timetable.csv';
        link.click();
    }

    function downloadAsXLSX() {
        const ws = XLSX.utils.json_to_sheet(timetableData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Timetable');
        XLSX.writeFile(wb, 'timetable.xlsx');
    }
</script>

</body>
</html>

