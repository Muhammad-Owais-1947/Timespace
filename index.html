<!DOCTYPE html>
<!-- 'scroll-smooth' enables smooth scrolling for anchor links -->
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!--  SEO: Title Tag -->
    <title>Time Space | AI Data Organizer</title>

    <!--  favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke-width='1.5' stroke='%233b82f6'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C6.095 4.01 5.25 4.973 5.25 6.108V18.75c0 1.243.87 2.25 1.976 2.25h4.272a2.25 2.25 0 002.25-2.25V5.117A2.25 2.25 0 0011.25 3H9.75a2.25 2.25 0 00-2.25 2.25z' /%3E%3C/svg%3E">
    
    <!-- SEO & External Libraries -->
    <meta name="description" content="Instantly analyze and organize any data. Upload a PDF, image, CSV, or Excel file and our AI will create a beautiful, interactive display.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <!-- Dark Mode Flash Fix -->
    <script>
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }
    </script>

    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'] } } } }
    </script>
    
    <!-- Main Stylesheet -->
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .modal-overlay { position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease, opacity 0.3s ease; }
        .modal-overlay.hidden { opacity: 0; pointer-events: none; }
        .modal-overlay.hidden .modal-content { transform: scale(0.95); opacity: 0; }
        .class-card { border-left-width: 4px; transition: transform 0.2s ease, box-shadow 0.2s ease; cursor: grab; }
        .dark .class-card { border-color: #374151; }
        .class-card p { word-break: break-word; }
        .class-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        .dark .class-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #data-table { width: 100%; border-collapse: collapse; table-layout: auto; }
        #data-table th, #data-table td { padding: 1rem 1.25rem; text-align: left; border-bottom: 1px solid #e5e7eb; word-wrap: break-word; }
        .dark #data-table th, .dark #data-table td { border-bottom-color: #374151; }
        #data-table th { background-color: #f9fafb; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #374151; }
        .dark #data-table th { background-color: #1f2d37; color: #d1d5db; }
        .btn-animate { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.2s ease-in-out, filter 0.2s ease-in-out; }
        .btn-animate:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); filter: brightness(1.05); }
        .dark .btn-animate:hover:not(:disabled) { box-shadow: 0 4px 14px rgba(0,0,0,0.25); }
        .btn-animate:disabled { opacity: 0.6; cursor: not-allowed; }
        .loader-overlay { position: fixed; inset: 0; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; background-color: rgba(248, 250, 252, 0.8); backdrop-filter: blur(4px); transition: opacity 0.5s ease-in-out; }
        .dark .loader-overlay { background-color: rgba(15, 23, 42, 0.8); }
        .loader-overlay.hidden { opacity: 0; pointer-events: none; }
        #scroll-to-top { position: fixed; bottom: 20px; right: 20px; opacity: 0; pointer-events: none; transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; transform: translateY(10px); z-index: 50;}
        #scroll-to-top.show { opacity: 1; pointer-events: auto; transform: translateY(0); }
        .category-label { padding: 0.125rem 0.625rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; display: inline-block; line-height: 1.25; }
        .feedback-emoji { transition: transform 0.2s ease; cursor: pointer; } .feedback-emoji:hover { transform: scale(1.2); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out, padding 0.3s ease-out; }
        .accordion-item.active .accordion-content { max-height: 200px; /* Adjust as needed */ }
        .accordion-item.active .accordion-arrow { transform: rotate(180deg); }
        .accordion-arrow { transition: transform 0.3s ease; }
        #text-input { resize: none; max-height: 15rem; /* NEW: Limit height */ overflow-y: auto; /* NEW: Add scroll on overflow */ }
        .cat-color-1 { background-color: #dcfce7; color: #166534; } .dark .cat-color-1 { background-color: #14532d; color: #dcfce7; } .card-cat-color-1 { border-left-color: #4ade80; } .bg-cat-color-1 { background-color: #f0fdf4; } .dark .bg-cat-color-1 { background-color: #164e3233; }
        .cat-color-2 { background-color: #dbeafe; color: #1e40af; } .dark .cat-color-2 { background-color: #1e3a8a; color: #dbeafe; } .card-cat-color-2 { border-left-color: #60a5fa; } .bg-cat-color-2 { background-color: #eff6ff; } .dark .bg-cat-color-2 { background-color: #1e3a8a33; }
        .cat-color-3 { background-color: #fee2e2; color: #991b1b; } .dark .cat-color-3 { background-color: #7f1d1d; color: #fee2e2; } .card-cat-color-3 { border-left-color: #f87171; } .bg-cat-color-3 { background-color: #fef2f2; } .dark .bg-cat-color-3 { background-color: #7f1d1d33; }
        .cat-color-4 { background-color: #cffafe; color: #0e7490; } .dark .cat-color-4 { background-color: #155e75; color: #cffafe; } .card-cat-color-4 { border-left-color: #22d3ee; } .bg-cat-color-4 { background-color: #ecfeff; } .dark .bg-cat-color-4 { background-color: #164e6333; }
        .cat-color-5 { background-color: #ede9fe; color: #5b21b6; } .dark .cat-color-5 { background-color: #4c1d95; color: #ede9fe; } .card-cat-color-5 { border-left-color: #a78bfa; } .bg-cat-color-5 { background-color: #faf5ff; } .dark .bg-cat-color-5 { background-color: #4c1d9533; }
        .cat-color-6 { background-color: #ffedd5; color: #9a3412; } .dark .cat-color-6 { background-color: #7c2d12; color: #ffedd5; } .card-cat-color-6 { border-left-color: #fb923c; } .bg-cat-color-6 { background-color: #fff7ed; } .dark .bg-cat-color-6 { background-color: #7c2d1233; }
        .cat-color-7 { background-color: #fce7f3; color: #9d174d; } .dark .cat-color-7 { background-color: #831843; color: #fce7f3; } .card-cat-color-7 { border-left-color: #f472b6; } .bg-cat-color-7 { background-color: #fdf4ff; } .dark .bg-cat-color-7 { background-color: #83184333; }
        .cat-color-0 { background-color: #f3f4f6; color: #374151; } .dark .cat-color-0 { background-color: #374151; color: #f3f4f6; } .card-cat-color-0 { border-left-color: #6b7280; } .bg-cat-color-0 { background-color: #f9fafb; } .dark .bg-cat-color-0 { background-color: #1f293733; }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-700 dark:text-slate-300">

<!-- Initial Page Loader -->
<div id="page-loader" class="loader-overlay">
    <div class="relative w-16 h-16">
        <div class="absolute inset-0 border-4 border-blue-200 dark:border-blue-800 rounded-full"></div>
        <div class="absolute inset-0 border-4 border-t-blue-600 dark:border-t-blue-400 rounded-full animate-spin"></div>
    </div>
    <p class="text-blue-600 dark:text-blue-400 font-medium mt-4 text-lg" data-translate-key="loading_analyzer">Loading Time Space...</p>
</div>

<!-- File Processing Loader -->
<div id="processing-loader" class="loader-overlay hidden">
     <div class="relative w-16 h-16">
        <div class="absolute inset-0 border-4 border-blue-200 dark:border-blue-800 rounded-full"></div>
        <div class="absolute inset-0 border-4 border-t-blue-600 dark:border-t-blue-400 rounded-full animate-spin"></div>
    </div>
    <p id="processing-quote" class="text-blue-600 dark:text-blue-400 font-medium mt-4 text-lg text-center px-4"></p>
</div>

<!-- Modals -->
<div id="version-modal" class="modal-overlay hidden">
    <div class="modal-content bg-white dark:bg-slate-800 w-full max-w-md m-4 p-6 rounded-2xl shadow-xl text-center">
        <h2 class="text-2xl font-bold text-blue-600 dark:text-blue-400">Step into Time Space 2.0 re-engineered for speed, clarity, and smarter insights.</h2>
        <p class="mt-4 text-slate-600 dark:text-slate-300">Smarter AI. Sharper downloads. Stronger security. Time Space 2.0 is here to make your data experience smoother than ever.</p>
        <button id="close-version-modal" class="btn-animate mt-6 w-full px-6 py-2 text-base font-semibold bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700">Got it!</button>
    </div>
</div>

<div id="admin-modal" class="modal-overlay hidden">
    <div class="modal-content bg-white dark:bg-slate-800 w-full max-w-sm m-4 p-6 rounded-2xl shadow-xl">
        <h2 class="text-xl font-bold text-slate-800 dark:text-slate-200 text-center">Admin Access</h2>
        <p id="admin-error" class="text-sm text-red-500 text-center mt-2 h-4"></p>
        <div class="mt-4">
            <label for="admin-password" class="text-sm font-medium text-slate-600 dark:text-slate-400">Password</label>
            <input type="password" id="admin-password" class="mt-1 w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div class="mt-6 flex gap-3">
            <button id="cancel-admin-login" class="btn-animate w-full px-4 py-2 text-sm font-semibold bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-500">Cancel</button>
            <button id="submit-admin-login" class="btn-animate w-full px-4 py-2 text-sm font-semibold bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700">Login</button>
        </div>
    </div>
</div>

<div id="lang-modal" class="modal-overlay hidden">
    <div class="modal-content bg-white dark:bg-slate-800 w-full max-w-sm m-4 p-6 rounded-2xl shadow-xl text-center">
        <h2 class="text-xl font-bold text-slate-800 dark:text-slate-200" data-translate-key="lang_modal_title">Choose Translation</h2>
        <p class="mt-2 text-sm text-slate-500 dark:text-slate-400" data-translate-key="lang_modal_desc">What would you like to translate?</p>
        <div class="mt-6 flex flex-col gap-3">
            <button id="translate-interface-btn" class="btn-animate w-full px-4 py-2 text-sm font-semibold bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700" data-translate-key="translate_interface">Translate Interface</button>
            <button id="translate-content-btn" class="btn-animate w-full px-4 py-2 text-sm font-semibold bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-500" data-translate-key="translate_content">Translate Data Content (AI)</button>
             <button id="cancel-lang-modal" class="mt-2 text-sm text-slate-500 hover:text-slate-700 dark:hover:text-slate-300">Cancel</button>
        </div>
    </div>
</div>

<!-- Header -->
<header class="sticky top-0 z-40 w-full bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm border-b border-slate-200 dark:border-slate-800 transition-transform duration-300">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
            <a href="#" class="flex items-center space-x-2">
                <svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" role="img" aria-label="Timetable Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C6.095 4.01 5.25 4.973 5.25 6.108V18.75c0 1.243.87 2.25 1.976 2.25h4.272a2.25 2.25 0 002.25-2.25V5.117A2.25 2.25 0 0011.25 3H9.75a2.25 2.25 0 00-2.25 2.25z" /></svg>
                <span class="font-bold text-lg sm:text-xl text-slate-900 dark:text-white" data-translate-key="site_name">Time Space</span>
            </a>
            <div class="flex items-center space-x-2 sm:space-x-4">
                <nav class="hidden md:flex items-center space-x-6 text-sm font-medium text-slate-600 dark:text-slate-400">
                    <a href="#why-us" class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors" data-translate-key="nav_why">Why Time Space?</a>
                    <a href="#features" class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors" data-translate-key="nav_features">Features</a>
                    <a href="#portfolio" class="hover:text-blue-600 dark:hover:text-blue-400 transition-colors" data-translate-key="nav_portfolio">Portfolio</a>
                </nav>
                <div class="h-6 w-px bg-slate-200 dark:bg-slate-700 hidden md:block"></div>
                <button id="admin-button" class="hidden md:flex items-center justify-center h-9 px-3 rounded-lg text-slate-500 hover:bg-slate-200 dark:text-slate-400 dark:hover:bg-slate-800 transition-colors btn-animate text-sm font-semibold">Admin</button>
                <button id="lang-toggle" class="h-9 w-9 flex items-center justify-center rounded-lg text-slate-500 hover:bg-slate-200 dark:text-slate-400 dark:hover:bg-slate-800 transition-colors btn-animate font-semibold text-xs"></button>
                <button id="theme-toggle" class="h-9 w-9 flex items-center justify-center rounded-lg text-slate-500 hover:bg-slate-200 dark:text-slate-400 dark:hover:bg-slate-800 transition-colors btn-animate">
                    <svg class="h-5 w-5 block dark:hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" role="img" aria-label="Moon Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" /></svg>
                    <svg class="h-5 w-5 hidden dark:block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" role="img" aria-label="Sun Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" /></svg>
                </button>
            </div>
        </div>
    </div>
</header>

<main>
    <section class="text-center py-16 sm:py-24 px-4 sm:px-6 lg:px-8">
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold tracking-tight text-slate-900 dark:text-white" data-translate-key="hero_title">Intelligent Data Organizer</h1>
        <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600 dark:text-slate-400" data-translate-key="hero_subtitle">Got messy data? Just upload it! Our specialised AI instantly cleans, sorts, and visualizes everything for you smart and simple.</p>
        <div id="data-app" class="max-w-7xl mx-auto mt-12 bg-white dark:bg-slate-800 rounded-2xl shadow-lg overflow-hidden border border-slate-200 dark:border-slate-700 text-left">
            <div id="upload-section" class="p-4 sm:p-8 flex flex-col items-center">
                 <div class="flex flex-col lg:flex-row gap-6 lg:gap-8 items-stretch w-full max-w-5xl mx-auto">
                    <!-- Left Side: Text Input -->
                    <div class="flex-1 flex flex-col">
                        <textarea id="text-input" class="w-full flex-grow p-3 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" rows="5" data-translate-key="text_input_placeholder" placeholder="Or paste your messy text here..."></textarea>
                        <button id="analyze-text-button" class="btn-animate mt-2 w-full px-6 py-3 text-base font-semibold bg-green-600 text-white rounded-lg shadow-md hover:bg-green-700 dark:hover:bg-green-500" data-translate-key="analyze_text_button">Paste any text, and we’ll analyze it instantly.</button>
                    </div>
                    <!-- Divider -->
                    <div class="flex items-center gap-2 lg:flex-col">
                        <hr class="w-full border-slate-300 dark:border-slate-600 lg:w-px lg:h-full">
                        <span class="text-sm font-semibold text-slate-500 dark:text-slate-400" data-translate-key="or_divider">OR</span>
                        <hr class="w-full border-slate-300 dark:border-slate-600 lg:w-px lg:h-full">
                    </div>
                    <!-- Right Side: File Upload -->
                    <div class="flex-1 flex flex-col justify-center items-center text-center p-4">
                        <button id="upload-button" class="btn-animate w-full max-w-xs px-6 py-3 text-base font-semibold bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 dark:hover:bg-blue-500" data-translate-key="upload_button">Upload Your Data File</button>
                        <input type="file" id="file-upload" accept="image/*,application/pdf,.csv" class="hidden"/>
                        <p class="text-sm text-slate-500 dark:text-slate-400 mt-3" data-translate-key="upload_caption">Max file size: 10MB. Supports PDF, PNG, JPG, CSV.</p>
                        <div id="upload-counter-wrapper" class="mt-2 text-sm text-slate-500 dark:text-slate-400">
                            <span data-translate-key="remaining_uploads">Remaining analyses (resets hourly):</span>
                            <span id="upload-counter" class="font-bold text-lg text-blue-600 dark:text-blue-400"></span>
                        </div>
                    </div>
                </div>
                <div id="status-message" class="mt-4 p-3 rounded-md text-sm text-center hidden w-full max-w-5xl mx-auto" role="alert"></div>
            </div>
            <div id="controls-area" class="hidden">
                 <div class="p-4 sm:p-6 border-b border-slate-200 dark:border-slate-700">
                    <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                          <label class="text-base font-semibold text-slate-800 dark:text-slate-100 whitespace-nowrap" data-translate-key="controls_title">The AI Magic✨Is Done, Time to Explore Your Data Story.</label>
                        <div class="flex items-center gap-2">
                              <div id="view-buttons" class="flex-shrink-0 flex items-center space-x-2 bg-slate-100 dark:bg-slate-900 p-1 rounded-md">
                                   <button id="view-card" class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors btn-animate" data-translate-key="card_view">Card View</button>
                                   <button id="view-table" class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors btn-animate" data-translate-key="table_view">Table View</button>
                            </div>
                            <button id="clear-data" class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors btn-animate bg-red-500 text-white hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700" data-translate-key="clear_button">Clear</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="results-area" class="bg-slate-50 dark:bg-slate-900/50 p-4 sm:p-6">
                <div id="data-container" class="space-y-4"></div>
                <div id="data-table-wrapper" class="overflow-x-auto rounded-lg border border-slate-200 dark:border-slate-700 hidden">
                    <table id="data-table">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
                 <div id="download-options" class="mt-6 flex flex-wrap gap-3 hidden">
                    <button id="download-pdf" class="btn-animate px-4 py-2 text-sm font-medium bg-blue-600 text-white rounded-md shadow-sm" data-translate-key="download_pdf">Download PDF</button>
                    <button id="download-png" class="btn-animate px-4 py-2 text-sm font-medium bg-emerald-600 text-white rounded-md shadow-sm" data-translate-key="download_png">Download PNG</button>
                    <button id="download-csv" class="btn-animate px-4 py-2 text-sm font-medium bg-slate-600 text-white rounded-md shadow-sm" data-translate-key="download_csv">Download CSV</button>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Why Us Section -->
    <section id="why-us" class="py-16 sm:py-24 bg-white dark:bg-slate-800">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white sm:text-4xl" data-translate-key="why_title">Stop wasting time on messy data. Start getting real insights.</h2>
                <p class="mt-4 text-lg max-w-3xl mx-auto text-slate-600 dark:text-slate-400" data-translate-key="why_subtitle">Your data hides answers — but finding them shouldn’t cost you hours. Meet Time Space, your AI-powered data assistant that organizes, analyzes, and visualizes instantly — saving you time and effort.</p>
            </div>
            <div id="why-us-accordion" class="mt-12 max-w-3xl mx-auto space-y-4">
                <!-- Accordion Items will be injected here by JS -->
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-16 sm:py-24">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white sm:text-4xl" data-translate-key="features_title">Powerful Features, Simple Interface</h2>
                <p class="mt-4 text-lg text-slate-600 dark:text-slate-400" data-translate-key="features_subtitle">Everything you need to manage your data efficiently.</p>
            </div>
            <div class="mt-12 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center bg-blue-100 dark:bg-blue-900/50 rounded-lg text-blue-600 dark:text-blue-400">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" role="img"><path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2.25l-3-3m0-3l3-3V12m0 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white" data-translate-key="feature1_title">Intelligent Categorization</h3>
                        <p class="mt-1 text-slate-600 dark:text-slate-400" data-translate-key="feature1_desc">Our AI intelligently identifies patterns, groups information, and adds color-coded clarity that makes complex data instantly readable.</p>
                    </div>
                </div>
                <div class="flex items-start space-x-4">
                     <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center bg-blue-100 dark:bg-blue-900/50 rounded-lg text-blue-600 dark:text-blue-400">
                         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" role="img"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.286zm0 13.036h.008v.008h-.008v-.008z" /></svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white" data-translate-key="feature2_title">Server-Side Security</h3>
                        <p class="mt-1 text-slate-600 dark:text-slate-400" data-translate-key="feature2_desc">Your Sensitive info like passwords and keys never touch your browser — our secure backend handles everything safely with anti-abuse protection.</p>
                    </div>
                </div>
                <div class="flex items-start space-x-4">
                    <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center bg-blue-100 dark:bg-blue-900/50 rounded-lg text-blue-600 dark:text-blue-400">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" role="img"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white" data-translate-key="feature3_title">Full & Flexible Exports</h3>
                        <p class="mt-1 text-slate-600 dark:text-slate-400" data-translate-key="feature3_desc">Every byte, every insight, yours to keep.Export your full dataset as a print-ready PDF, high-res PNG, or standard CSV with zero cut-offs.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Portfolio Section -->
    <section id="portfolio" class="py-16 sm:py-24 bg-white dark:bg-slate-800">
        <div class="max-w-3xl mx-auto text-center px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white sm:text-4xl" data-translate-key="portfolio_title">Every project tells a story</h2>
            <p class="mt-4 text-lg text-slate-600 dark:text-slate-400" data-translate-key="portfolio_desc">Want to see more? Head to my portfolio and explore how each idea turned into something real.</p>
            <div class="mt-8">
                <a href="https://muhammad-owais-1947.github.io/portfolio/" target="_blank" rel="noopener noreferrer" class="btn-animate inline-block px-8 py-3 text-base font-semibold bg-blue-600 text-white rounded-lg shadow-md" data-translate-key="portfolio_button">
                    Check Out What I’ve Built
                </a>
            </div>
        </div>
    </section>
</main>

<!-- Footer -->
<footer class="bg-slate-50 dark:bg-slate-900 border-t border-slate-200 dark:border-slate-700">
    <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500 dark:text-slate-400">
        <div class="flex flex-col items-center gap-4">
             <button id="get-in-touch-btn" class="btn-animate inline-flex items-center justify-center px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-full text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 font-medium" title="Get in Touch">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2"><path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" /></svg>
                <span data-translate-key="get_in_touch">Get in Touch</span>
            </button>
            <div id="feedback-emojis" class="flex items-center gap-3 text-2xl">
                <span class="feedback-emoji" data-rating="1" title="Terrible">😞</span>
                <span class="feedback-emoji" data-rating="2" title="Okay">😐</span>
                <span class="feedback-emoji" data-rating="3" title="Good">🙂</span>
                <span class="feedback-emoji" data-rating="4" title="Awesome!">🤩</span>
            </div>
            <p data-translate-key="footer_text">&copy; 2025 Time Space. All rights reserved. Crafted with Code & Coffee ☕ — Muhammad Owais.</p>
        </div>
    </div>
</footer>

<!-- Scroll-to-Top Button -->
<button id="scroll-to-top" class="btn-animate h-12 w-12 rounded-full bg-blue-600 text-white shadow-lg flex items-center justify-center hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600" aria-label="Scroll to top">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />
    </svg>
</button>

<script>
    // ===================================================================================
    // CONFIGURATION & GLOBAL STATE
    // ===================================================================================
    
    // 1. Paste the URL you get from your Cloudflare Worker dashboard. It must start with https://
    const SECURE_API_URL = "https://codesecurity.pubg89r3.workers.dev/";

    // 2. CUSTOMIZE THE AI's BEHAVIOR
    const GEMINI_SYSTEM_PROMPT = `You are a world-class data analyst. Your primary function is to deeply analyze user-provided content (text, tables, or images) and extract structured data from it, returning it as a clean JSON array of objects.
        Your analysis must be meticulous. Follow these rules with precision:
        1.  **Infer Context and Structure:** Do not just transcribe. Understand the *purpose* of the data. Is it a class schedule, a contact list, a project plan, an inventory? Use this context to create logical, well-named headers (JSON keys).
        2.  **Identify Primary Fields:** Determine the most important field in each record (like a name, title, or main subject) and ensure it's a distinct key. This will likely be the main identifier for each object in the array.
        3.  **Comprehensive Data Extraction:** Extract every single piece of relevant information. Do not miss any details, no matter how small. This includes names, dates, times, codes, locations, descriptions, and any other pertinent data.
        4.  **Perfect Headers:** Create clear, descriptive, and correctly spelled headers for each data column. For example, instead of "C.Code", use "Course Code". Instead of "faculty", use "Faculty Name".
        5.  **Well-Formatted Values:** Clean up the data you extract. Ensure consistent formatting, correct spelling, and proper capitalization.
        6.  **Image Analysis:** If an image is provided, analyze its content deeply. If it contains text or tabular data, extract it as if it were a document.
        7.  **Accuracy is Paramount:** Your final output must be an accurate and complete representation of the source material.
        8.  **Output Format:** Your final output MUST be only the JSON array. Do not include any introductory text, markdown formatting like \`\`\`json, or any explanations.`;
    
    // --- GLOBAL STATE & CONSTANTS ---
    const MAX_FILE_SIZE = 10 * 1024 * 1024;
    const USER_UPLOAD_LIMIT = 5;
    const UPLOAD_LIMIT_HOURS = 1;
    const ADMIN_ATTEMPT_LIMIT = 5;
    let isAdmin = false;
    let adminPassword = ''; 
    let appData = [];
    let dataHeaders = [];
    let categoryColumnKey = '';
    let categoryColorMap = {};
    let currentView = 'card';
    const motivationalQuotes = [
        { en: "Turning your data into gold...", ur: "Aapke data ko sonay mein badal rahe hain..." },
        { en: "Organizing chaos, one byte at a time...", ur: "Har byte ko tarteeb de rahe hain..." },
        { en: "Unlocking the stories in your files...", ur: "Aapki files ki kahaniyan khol rahe hain..." },
    ];
    // New default data extracted from the provided image
    const defaultTimetableData = [
        { "Day of Week": "Monday", "Course Time": "03:30 PM - 04:45 PM", "Course Code": "IS230", "Course Name": "Emerging Technologies", "Faculty Name": "Nagesh-Kumar", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "SST-101" },
        { "Day of Week": "Monday", "Course Time": "02:00 PM - 03:15 PM", "Course Code": "IS240", "Course Name": "Management Information System", "Faculty Name": "Unconfirmed", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "2N-02" },
        { "Day of Week": "Tuesday", "Course Time": "05:00 PM - 06:15 PM", "Course Code": "FN340", "Course Name": "Business Finance", "Faculty Name": "Dr. M Mahmood Shah Khan", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "2N-03" },
        { "Day of Week": "Tuesday", "Course Time": "03:30 PM - 04:45 PM", "Course Code": "MK210", "Course Name": "Principles of Marketing", "Faculty Name": "Dr. Abdul Waheed", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "1C-15" },
        { "Day of Week": "Wednesday", "Course Time": "08:00 AM - 09:15 AM", "Course Code": "IS360", "Course Name": "Data Communication and Networking", "Faculty Name": "Abdul Ghafar", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "2N-12" },
        { "Day of Week": "Wednesday", "Course Time": "09:30 AM - 10:45 AM", "Course Code": "IS360", "Course Name": "Data Communication and Networking", "Faculty Name": "Abdul Ghafar", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "2N-12" },
        { "Day of Week": "Thursday", "Course Time": "03:30 PM - 04:45 PM", "Course Code": "IS230", "Course Name": "Emerging Technologies", "Faculty Name": "Nagesh-Kumar", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "SST-101" },
        { "Day of Week": "Thursday", "Course Time": "02:00 PM - 03:15 PM", "Course Code": "IS240", "Course Name": "Management Information System", "Faculty Name": "Unconfirmed", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "2N-02" },
        { "Day of Week": "Friday", "Course Time": "11:00 AM - 12:15 PM", "Course Code": "IS412", "Course Name": "IT Project Management", "Faculty Name": "Sana Amjad", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "2N-12" },
        { "Day of Week": "Friday", "Course Time": "05:00 PM - 06:15 PM", "Course Code": "FN340", "Course Name": "Business Finance", "Faculty Name": "Dr. M Mahmood Shah Khan", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "2N-03" },
        { "Day of Week": "Friday", "Course Time": "03:30 PM - 04:45 PM", "Course Code": "MK210", "Course Name": "Principles of Marketing", "Faculty Name": "Dr. Abdul Waheed", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "1C-15" },
        { "Day of Week": "Friday", "Course Time": "02:00 PM - 03:15 PM", "Course Code": "IS412", "Course Name": "IT Project Management", "Faculty Name": "Sana Amjad", "Lecture Type": "Theory", "Delivery Mode": "On-Campus", "Room Number": "2N-12" }
    ];

    // --- DOM ELEMENT SELECTORS ---
    let allDOMElements = {};

    // --- TRANSLATIONS (separated for clarity) ---
    const translations = { 
        en: { 
            site_name: "Time Space", nav_why: "Why Time Space?", nav_features: "Features", nav_portfolio: "Portfolio", 
            hero_title: "Intelligent Data Organizer", hero_subtitle: "Got messy data? Just upload it! Our specialised AI instantly cleans, sorts, and visualizes everything for you smart and simple.", 
            text_input_placeholder: "Or paste your messy text here...", analyze_text_button: "Analyze Pasted Text", or_divider: "OR",
            upload_button: "Upload Your Data File", upload_caption: "Max file size: 10MB. Supports PDF, PNG, JPG, CSV.", remaining_uploads: "Remaining analyses this hour:",
            controls_title: "✨ AI Analysis Complete — Here’s Your Interactive Data!", card_view: "Card View", table_view: "Table View", clear_button: "Clear", 
            download_pdf: "Download PDF", download_png: "Download PNG", download_csv: "Download CSV", 
            why_title: "Stop Wasting Time. Start Getting Answers.", why_subtitle: "Your data holds valuable insights, but who has time to manually sort through messy files? Time Space is your personal data assistant, built to give you back your most valuable asset: time.",
            why1_title: "For Students", why1_desc: "Instantly digitize and organize your class schedules, study notes, or research data from a single photo or PDF.",
            why2_title: "For Professionals", why2_desc: "Turn invoices, business cards, or project plans into structured, exportable data in seconds. No more manual entry.",
            why3_title: "For Anyone", why3_desc: "From recipe collections to workout logs, if you can capture it, Time Space can organize it. Bring clarity to your life.",
            features_title: "Powerful Features, Simple Interface", features_subtitle: "Everything you need to manage your data efficiently.",
            feature1_title: "Intelligent Categorization", feature1_desc: "Our AI intelligently identifies patterns, groups information, and adds color-coded clarity that makes complex data instantly readable.",
            feature2_title: "Server-Side Security", feature2_desc: "Your Sensitive info like passwords and keys never touch your browser — our secure backend handles everything safely with anti-abuse protection.",
            feature3_title: "Full & Flexible Exports", feature3_desc: "Every byte, every insight, yours to keep.Export your full dataset as a print-ready PDF, high-res PNG, or standard CSV with zero cut-offs.",
            portfolio_title: "Every project tells a story", portfolio_desc: "Want to see more? Head to my portfolio and explore how each idea turned into something real.", portfolio_button: "Check Out What I’ve Built", 
            get_in_touch: "Get in Touch", footer_text: "© 2025 Time Space. All rights reserved. Crafted with Code & Coffee ☕ — Muhammad Owais.", 
            loading_analyzer: "Loading Time Space...", analyzing: "Making magic behind the scenes...", translating: "Translating your data with AI...",
            welcome_message: "Welcome! The default timetable is loaded. Upload a file or paste text to see the magic.", 
            schedule_cleared: "Data cleared. Showing default timetable again.", file_uploaded: "File upload successful, processing...", preparing_pdf: "Generating PDF...", preparing_png: "Generating PNG...",
            lang_modal_title: "Choose Translation", lang_modal_desc: "What would you like to translate?", translate_interface: "Translate Interface", translate_content: "Translate Data Content (AI)",
            // Creative Errors
            no_data: "The data dimension is empty. Try uploading a file!",
            unsupported_file_type: "Whoa there! That file type is a bit too exotic for me. Try a PDF, PNG, JPG, or CSV.",
            file_too_large: "That's a hefty file! My circuits can only handle up to 10MB. Can you shrink it a bit?",
            upload_limit_reached: "You're on fire! You've hit the hourly analysis limit. Take a short break, or switch to Admin Mode for unlimited power.",
            api_not_configured: "Uh oh, a wire is loose on our end. The developer needs to configure the API endpoint.",
            ai_error: "Hmm, the AI gazed into your data but found... a mystery. Could you check if the file is empty or has a really unusual format?",
            incorrect_password: "Incorrect password. The digital gates remain closed.",
            lockout_message: "Too many incorrect attempts. For security, you're locked out for a bit. Time for a coffee break?",
            empty_text_error: "Can't analyze thin air! Please paste some text before analyzing."
        }, 
        ur: {
            // Urdu translations will be added here
        } 
    };
    let currentLang = 'en';
    function getText(key, lang = currentLang) { return (translations[lang] && translations[lang][key]) ? translations[lang][key] : key; }


    // This runs once the entire HTML document is loaded and ready.
    document.addEventListener('DOMContentLoaded', () => {
        
        // ===================================================================================
        // INITIALIZATION & CORE SETUP
        // ===================================================================================

        function initializeApp() {
            // Select and store all necessary DOM elements for easy access
            allDOMElements = {
                pageLoader: document.getElementById('page-loader'),
                processingLoader: document.getElementById('processing-loader'),
                processingQuote: document.getElementById('processing-quote'),
                statusMessage: document.getElementById('status-message'),
                dataContainer: document.getElementById('data-container'),
                dataTableWrapper: document.getElementById('data-table-wrapper'),
                dataTable: document.getElementById('data-table'),
                controlsArea: document.getElementById('controls-area'),
                downloadOptions: document.getElementById('download-options'),
                fileUpload: document.getElementById('file-upload'),
                uploadButton: document.getElementById('upload-button'),
                textInput: document.getElementById('text-input'),
                analyzeTextButton: document.getElementById('analyze-text-button'),
                uploadCounterWrapper: document.getElementById('upload-counter-wrapper'),
                uploadCounter: document.getElementById('upload-counter'),
                clearDataBtn: document.getElementById('clear-data'),
                scrollToTopBtn: document.getElementById('scroll-to-top'),
                pageHeader: document.querySelector('header'),
                themeToggle: document.getElementById('theme-toggle'),
                langToggle: document.getElementById('lang-toggle'),
                versionModal: document.getElementById('version-modal'),
                closeVersionModal: document.getElementById('close-version-modal'),
                adminModal: document.getElementById('admin-modal'),
                adminButton: document.getElementById('admin-button'),
                cancelAdminLogin: document.getElementById('cancel-admin-login'),
                submitAdminLogin: document.getElementById('submit-admin-login'),
                adminPasswordInput: document.getElementById('admin-password'),
                adminError: document.getElementById('admin-error'),
                langModal: document.getElementById('lang-modal'),
                translateInterfaceBtn: document.getElementById('translate-interface-btn'),
                translateContentBtn: document.getElementById('translate-content-btn'),
                cancelLangModalBtn: document.getElementById('cancel-lang-modal'),
                getInTouchBtn: document.getElementById('get-in-touch-btn'),
                feedbackEmojis: document.getElementById('feedback-emojis'),
                whyUsAccordion: document.getElementById('why-us-accordion'),
            };
            
            buildWhyUsAccordion();
            setupEventListeners();
            const savedLang = localStorage.getItem('language') || 'en';
            setLanguage(savedLang, false);
            
            updateUploadCounterUI();

            // Hide the main page loader after a short delay
            setTimeout(() => { allDOMElements.pageLoader.classList.add('hidden'); }, 500);
            
            // Show the "Welcome to v2.0" popup if it hasn't been shown before
            if (!localStorage.getItem('version2_popup_shown')) {
                setTimeout(() => { if (allDOMElements.versionModal) allDOMElements.versionModal.classList.remove('hidden'); }, 5000);
            }

            // Load the default data and render it on the screen
            appData = JSON.parse(JSON.stringify(defaultTimetableData));
            prepareAndRender();
            showStatus('welcome_message', 'success');
        }

        // ===================================================================================
        // EVENT LISTENERS
        // ===================================================================================

        function setupEventListeners() {
            // Hide header on scroll down, show on scroll up for better mobile experience
            let lastScrollTop = 0;
            window.addEventListener('scroll', () => {
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                if(allDOMElements.pageHeader) allDOMElements.pageHeader.style.transform = (scrollTop > lastScrollTop && scrollTop > allDOMElements.pageHeader.offsetHeight) ? 'translateY(-100%)' : 'translateY(0)';
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
                if(allDOMElements.scrollToTopBtn) allDOMElements.scrollToTopBtn.classList.toggle('show', window.pageYOffset > 300);
            });

            // --- General UI Interactions ---
            allDOMElements.scrollToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
            allDOMElements.themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
            });
            allDOMElements.langToggle.addEventListener('click', () => allDOMElements.langModal.classList.remove('hidden'));
            allDOMElements.cancelLangModalBtn.addEventListener('click', () => allDOMElements.langModal.classList.add('hidden'));
            allDOMElements.closeVersionModal.addEventListener('click', () => {
                allDOMElements.versionModal.classList.add('hidden');
                localStorage.setItem('version2_popup_shown', 'true');
            });

            // --- Translation Logic ---
            allDOMElements.translateInterfaceBtn.addEventListener('click', () => {
                setLanguage(currentLang === 'en' ? 'ur' : 'en', true);
                allDOMElements.langModal.classList.add('hidden');
            });
            allDOMElements.translateContentBtn.addEventListener('click', handleContentTranslation);

            // --- Data Input & Control Logic ---
            allDOMElements.uploadButton.addEventListener('click', () => allDOMElements.fileUpload.click());
            allDOMElements.fileUpload.addEventListener('change', handleFileUpload);
            allDOMElements.analyzeTextButton.addEventListener('click', handleTextAnalysis);
            allDOMElements.clearDataBtn.addEventListener('click', clearData);
            document.querySelectorAll('#view-buttons button').forEach(btn => btn.addEventListener('click', () => switchView(btn.id.replace('view-', ''))));
            
            // NEW FEATURE: Auto-resizing textarea with a max-height
            allDOMElements.textInput.addEventListener('input', (e) => {
                e.target.style.height = 'auto'; // Reset height
                e.target.style.height = (e.target.scrollHeight) + 'px'; // Set to scroll height
            });
            
            // --- Export Logic ---
            document.getElementById('download-pdf').addEventListener('click', () => downloadAsPDF());
            document.getElementById('download-png').addEventListener('click', () => downloadAsPNG());
            document.getElementById('download-csv').addEventListener('click', () => downloadAsCSV());

            // --- Admin Modal Logic ---
            allDOMElements.adminButton.addEventListener('click', () => {
                 if (isAdmin) {
                    isAdmin = false;
                    adminPassword = ''; 
                    updateAdminButtonUI();
                    updateUploadCounterUI();
                } else {
                    allDOMElements.adminModal.classList.remove('hidden');
                }
            });
            allDOMElements.cancelAdminLogin.addEventListener('click', () => {
                allDOMElements.adminModal.classList.add('hidden');
                allDOMElements.adminError.textContent = '';
                allDOMElements.adminPasswordInput.value = '';
            });
            allDOMElements.submitAdminLogin.addEventListener('click', handleAdminLogin);
            allDOMElements.adminPasswordInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') handleAdminLogin(); });
            
            // --- Footer Logic ---
            const baseMailLink = "https://mail.google.com/mail/?view=cm&fs=1&to=professional.OTS@Gmail.com";
            allDOMElements.getInTouchBtn.addEventListener('click', () => {
                window.open(`${baseMailLink}&su=Inquiry%20from%20Time%20Space%20User`, '_blank');
            });
            allDOMElements.feedbackEmojis.querySelectorAll('.feedback-emoji').forEach(emoji => {
                emoji.addEventListener('click', () => {
                    const rating = emoji.getAttribute('data-rating');
                    const title = emoji.getAttribute('title');
                    window.open(`${baseMailLink}&su=Feedback:%20${rating}-Star%20(${title})`, '_blank');
                });
            });
        }
        
        // ===================================================================================
        // LANGUAGE & UI MANAGEMENT
        // ===================================================================================
        
        function setLanguage(lang, toggle = true) {
            currentLang = lang;
            document.documentElement.lang = currentLang;
            allDOMElements.langToggle.textContent = currentLang === 'en' ? 'UR' : 'EN';
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.dataset.translateKey;
                if (el.placeholder) el.placeholder = getText(key); else el.textContent = getText(key);
            });
            localStorage.setItem('language', currentLang);
            buildWhyUsAccordion(); // Rebuild accordion with new language
        }
        
        function showStatus(messageKey, type, customMessage = null) {
            allDOMElements.statusMessage.textContent = customMessage || getText(messageKey);
            allDOMElements.statusMessage.className = `mt-4 p-3 rounded-md text-sm text-center w-full max-w-5xl mx-auto ${type === 'error' ? 'bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300' : 'bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300'}`;
            allDOMElements.statusMessage.classList.remove('hidden');
        }

        function buildWhyUsAccordion() {
            const items = [
                { titleKey: 'why1_title', descKey: 'why1_desc' },
                { titleKey: 'why2_title', descKey: 'why2_desc' },
                { titleKey: 'why3_title', descKey: 'why3_desc' }
            ];
            const accordionContainer = allDOMElements.whyUsAccordion;
            accordionContainer.innerHTML = '';

            items.forEach((item) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'accordion-item border border-slate-200 dark:border-slate-700 rounded-lg';
                itemEl.innerHTML = `
                    <button class="accordion-header w-full flex justify-between items-center text-left p-4 bg-slate-50 dark:bg-slate-900/50 rounded-lg focus:outline-none">
                        <h3 class="text-lg font-semibold text-slate-900 dark:text-white" data-translate-key="${item.titleKey}">${getText(item.titleKey)}</h3>
                        <svg class="accordion-arrow w-5 h-5 text-slate-500 dark:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                    </button>
                    <div class="accordion-content">
                        <div class="p-4 border-t border-slate-200 dark:border-slate-700">
                            <p class="text-slate-600 dark:text-slate-400" data-translate-key="${item.descKey}">${getText(item.descKey)}</p>
                        </div>
                    </div>`;
                accordionContainer.appendChild(itemEl);

                itemEl.querySelector('.accordion-header').addEventListener('click', () => {
                    const isActive = itemEl.classList.contains('active');
                    accordionContainer.querySelectorAll('.accordion-item').forEach(i => i.classList.remove('active'));
                    if (!isActive) itemEl.classList.add('active');
                });
            });
        }

        // ===================================================================================
        // SECURITY & RATE LIMITING (Client-Side)
        // ===================================================================================

        function checkAdminLockout() {
            const lockout = JSON.parse(localStorage.getItem('adminLockout'));
            if (lockout && new Date().getTime() < lockout.until) {
                const minutesLeft = Math.ceil((lockout.until - new Date().getTime()) / 60000);
                return getText('lockout_message') + ` (${minutesLeft}m left)`;
            }
            return false;
        }

        function recordAdminFailure() {
            let attempts = JSON.parse(localStorage.getItem('adminAttempts')) || [];
            const now = new Date().getTime();
            const oneHourAgo = now - (60 * 60 * 1000);
            attempts = attempts.filter(ts => ts > oneHourAgo).concat(now);
            if (attempts.length >= ADMIN_ATTEMPT_LIMIT) {
                localStorage.setItem('adminLockout', JSON.stringify({ until: now + (60 * 60 * 1000) }));
                attempts = [];
            }
            localStorage.setItem('adminAttempts', JSON.stringify(attempts));
        }

        async function handleAdminLogin() {
            const lockoutMessage = checkAdminLockout();
            if (lockoutMessage) {
                showStatus(null, 'error', lockoutMessage);
                return;
            }

            const enteredPassword = allDOMElements.adminPasswordInput.value;
            allDOMElements.adminError.textContent = 'Verifying...';
            allDOMElements.submitAdminLogin.disabled = true;

            try {
                if (SECURE_API_URL === "PASTE_YOUR_CLOUDFLARE_WORKER_URL_HERE" || !SECURE_API_URL.startsWith('https://')) {
                    throw new Error(getText("api_not_configured"));
                }
                const response = await fetch(SECURE_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'verifyAdmin', password: enteredPassword })
                });

                if (response.status === 401) throw new Error(getText("incorrect_password"));
                if (!response.ok) {
                    const err = await response.json().catch(() => ({ error: `Network error: ${response.statusText}` }));
                    throw new Error(err.error);
                }
                
                const result = await response.json();
                if (result.success) {
                    isAdmin = true;
                    adminPassword = enteredPassword;
                    localStorage.removeItem('adminAttempts');
                    localStorage.removeItem('adminLockout');
                    allDOMElements.cancelAdminLogin.click();
                } else {
                     throw new Error(getText("incorrect_password"));
                }
            } catch (error) {
                isAdmin = false;
                adminPassword = '';
                recordAdminFailure();
                allDOMElements.adminError.textContent = error.message;
            } finally {
                allDOMElements.submitAdminLogin.disabled = false;
                updateAdminButtonUI();
                updateUploadCounterUI();
            }
        }

        function updateAdminButtonUI() {
            if (isAdmin) {
                allDOMElements.adminButton.textContent = 'Admin Mode ✅';
                allDOMElements.adminButton.classList.add('text-green-500', 'dark:text-green-400');
                showStatus('Admin mode activated. Upload limit removed.', 'success');
            } else {
                allDOMElements.adminButton.textContent = 'Admin';
                allDOMElements.adminButton.classList.remove('text-green-500', 'dark:text-green-400');
            }
        }
        
        function checkUploadLimit() {
            if (isAdmin) return true;
            const now = new Date().getTime();
            const oneHourAgo = now - (UPLOAD_LIMIT_HOURS * 60 * 60 * 1000);
            const uploads = JSON.parse(localStorage.getItem('userUploads') || '[]');
            const recentUploads = uploads.filter(timestamp => timestamp > oneHourAgo);
            localStorage.setItem('userUploads', JSON.stringify(recentUploads));
            return recentUploads.length < USER_UPLOAD_LIMIT;
        }

        function updateUploadCounterUI() {
            if (isAdmin) {
                allDOMElements.uploadCounterWrapper.classList.add('hidden');
                return;
            }
            allDOMElements.uploadCounterWrapper.classList.remove('hidden');
            const uploads = JSON.parse(localStorage.getItem('userUploads') || '[]');
            const remaining = USER_UPLOAD_LIMIT - uploads.length;
            allDOMElements.uploadCounter.textContent = Math.max(0, remaining);
        }

        function recordUpload() {
            if (isAdmin) return;
            const uploads = JSON.parse(localStorage.getItem('userUploads') || '[]');
            uploads.push(new Date().getTime());
            localStorage.setItem('userUploads', JSON.stringify(uploads));
            updateUploadCounterUI();
        }

        // ===================================================================================
        // DATA INPUT & PROCESSING
        // ===================================================================================
        
        async function processInput(mimeType, data, isTranslation = false) {
             if (!checkUploadLimit() && !isTranslation) {
                showStatus("upload_limit_reached", "error");
                return;
            }
            allDOMElements.processingQuote.textContent = getText(isTranslation ? 'translating' : 'analyzing');
            allDOMElements.processingLoader.classList.remove('hidden');
            allDOMElements.statusMessage.classList.add('hidden');
            if (!isTranslation) {
                [allDOMElements.dataContainer, allDOMElements.dataTableWrapper, allDOMElements.controlsArea, allDOMElements.downloadOptions].forEach(el => el.classList.add('hidden'));
            }

            try {
                await callSmartAI(mimeType, data, isTranslation);
                if (!isTranslation) recordUpload();
            } catch (error) {
                console.error('Processing error:', error);
                showStatus('ai_error', 'error', error.message.includes("API URL") ? error.message : getText('ai_error'));
            } finally {
                allDOMElements.processingLoader.classList.add('hidden');
            }
        }

        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            if (file.size > MAX_FILE_SIZE) { return showStatus('file_too_large', 'error'); }
            const fileExt = file.name.split('.').pop().toLowerCase();
            const data = (fileExt === 'csv') ? await parseCSV(file) : await fileToBase64(file);
            const mimeType = (fileExt === 'csv') ? 'application/json' : file.type; // Send CSVs as structured JSON
            const dataForAI = (mimeType === 'application/json') ? JSON.stringify(data) : data;
            processInput(mimeType, dataForAI);
        }

        async function handleTextAnalysis() {
            const text = allDOMElements.textInput.value.trim();
            if (!text) {
                showStatus('empty_text_error', 'error');
                return;
            }
            processInput('text/plain', text);

            // NEW: Clear the textarea and reset its height after analysis starts
            allDOMElements.textInput.value = '';
            allDOMElements.textInput.style.height = 'auto';
        }

        /** Converts a file object to a Base64 encoded string for API processing. */
        function fileToBase64(file) { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.onload = () => resolve(reader.result.split(',')[1]); reader.onerror = reject; reader.readAsDataURL(file); }); }
        
        /** Parses a CSV file into a structured array of objects. */
        function parseCSV(file) { return new Promise((resolve, reject) => Papa.parse(file, { header: true, complete: res => res.errors.length ? reject(res.errors[0]) : resolve(res.data), error: reject, skipEmptyLines: true })); }
        
        async function handleContentTranslation() {
            allDOMElements.langModal.classList.add('hidden');
            if (!appData || appData.length === 0) return;
            processInput('application/json', appData, true);
        }

        // ===================================================================================
        // AI INTERACTION (API CALLS)
        // ===================================================================================

        async function callSmartAI(mimeType, dataForAI, isTranslation = false) {
            if (SECURE_API_URL === "PASTE_YOUR_CLOUDFLARE_WORKER_URL_HERE" || !SECURE_API_URL.startsWith('https://')) {
                throw new Error(getText("api_not_configured"));
            }

            let payload;
            if (isTranslation) {
                payload = { action: 'translateData', dataToTranslate: dataForAI, targetLanguage: currentLang === 'en' ? 'Roman Urdu' : 'English' };
            } else {
                 payload = { action: 'analyzeData', mimeType, dataForAI, systemPrompt: GEMINI_SYSTEM_PROMPT };
            }

            if (isAdmin && adminPassword) payload.adminPassword = adminPassword;
            
            const response = await fetch(SECURE_API_URL, { 
                method: 'POST', 
                headers: { 'Content-Type': 'application/json' }, 
                body: JSON.stringify(payload) 
            });
            
            if (!response.ok) {
                const errorResult = await response.json().catch(() => ({error: `API error: ${response.statusText}`}));
                throw new Error(errorResult.error);
            }
            const parsedData = await response.json();
            if (!Array.isArray(parsedData) || parsedData.length === 0) {
                throw new Error(getText("ai_error"));
            }
            appData = parsedData;
            prepareAndRender();
        }

        // ===================================================================================
        // DYNAMIC UI RENDERING
        // ===================================================================================
        
        function findCategoryColumnKey(headers) {
            const priorityHeaders = ['day', 'weekday', 'status', 'type', 'category', 'Day of Week'];
            for (const pHeader of priorityHeaders) {
                const foundHeader = headers.find(h => h.toLowerCase() === pHeader.toLowerCase());
                if (foundHeader) return foundHeader;
            }
            return headers[0] || '';
        }

        function setupCategorization() {
            if (!appData || appData.length === 0) return;
            dataHeaders = Object.keys(appData[0]);
            categoryColumnKey = findCategoryColumnKey(dataHeaders);

            if (categoryColumnKey) {
                const uniqueValues = [...new Set(appData.map(item => item[categoryColumnKey]))];
                const colorClasses = ['cat-color-1', 'cat-color-2', 'cat-color-3', 'cat-color-4', 'cat-color-5', 'cat-color-6', 'cat-color-7'];
                
                categoryColorMap = uniqueValues.reduce((map, value, index) => {
                    const colorIndex = (index % colorClasses.length) + 1;
                    map[value] = {
                        label: `cat-color-${colorIndex}`,
                        cardBorder: `card-cat-color-${colorIndex}`,
                        bg: `bg-cat-color-${colorIndex}`
                    };
                    return map;
                }, {});
            } else {
                categoryColorMap = {};
            }
        }
        
        function clearData() { appData = JSON.parse(JSON.stringify(defaultTimetableData)); prepareAndRender(); showStatus('schedule_cleared', 'success'); }

        function prepareAndRender(defaultView = 'card') {
            setupCategorization(); 
            allDOMElements.controlsArea.classList.remove('hidden');
            allDOMElements.downloadOptions.classList.remove('hidden');
            if (!appData || appData.length === 0) { 
                allDOMElements.dataContainer.innerHTML = `<p class="text-center text-slate-500 p-8">${getText('no_data')}</p>`;
                return;
            }
            switchView(categoryColumnKey ? defaultView : 'table');
        }
        
        // --- RENDER CARD VIEW ---
        // NEW FEATURE: This function creates a single responsive grid.
        // It adds full-width group headings directly to the grid,
        // followed by the cards for that group. This ensures cards
        // from all groups fill the available space efficiently.
        function renderCardView() { 
            const { dataContainer } = allDOMElements;
            dataContainer.innerHTML = '';
            // The main container is now the grid, replacing the old `space-y-4`
            dataContainer.className = 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4';
            
            const groupedData = appData.reduce((acc, item) => {
                const key = categoryColumnKey ? (item[categoryColumnKey] || 'Uncategorized') : 'All Entries';
                (acc[key] = acc[key] || []).push(item);
                return acc;
            }, {});

            Object.keys(groupedData).forEach(groupKey => {
                const colorInfo = categoryColorMap[groupKey] || { label: 'cat-color-0', cardBorder: 'card-cat-color-0', bg: 'bg-cat-color-0' };
                
                // Add group heading if there's a category
                if (categoryColumnKey && groupKey !== 'All Entries') {
                    const heading = document.createElement('h3');
                    // Make the heading span all columns
                    heading.className = "text-xl font-bold mt-6 mb-2 flex items-center gap-2 col-span-full";
                    heading.innerHTML = `<span class="category-label ${colorInfo.label}">${groupKey}</span>`;
                    dataContainer.appendChild(heading);
                }

                // Add cards for this group directly to the main grid container
                groupedData[groupKey].forEach(entry => {
                    let cardContent = '';
                    let titleRendered = false;
                    
                    dataHeaders.forEach((header, i) => {
                         if (header === categoryColumnKey) return; 
                        const value = entry[header] || 'N/A';
                        const isTitleCandidate = header.toLowerCase().includes('name') || header.toLowerCase().includes('title');
                        
                        if (!titleRendered && (isTitleCandidate || i === (categoryColumnKey ? 1 : 0) )) {
                            cardContent += `<h4 class="font-bold text-xl text-slate-800 dark:text-slate-100 mb-2">${value}</h4>`;
                            titleRendered = true;
                        } else {
                            cardContent += `<p class="text-sm"><strong class="font-semibold text-slate-700 dark:text-slate-300 capitalize">${header.replace(/_/g, ' ')}:</strong> <span class="break-words text-slate-500 dark:text-slate-400">${value}</span></p>`;
                        }
                    });

                    const cardDiv = document.createElement('div');
                    cardDiv.className = `class-card p-4 rounded-lg shadow-sm ${colorInfo.cardBorder} ${colorInfo.bg}`;
                    cardDiv.innerHTML = `<div class="flex flex-col gap-1">${cardContent}</div>`;
                    dataContainer.appendChild(cardDiv);
                });
            });

            dataContainer.classList.remove('hidden');
        }

        function renderTableView() { 
            const { dataTable, dataTableWrapper } = allDOMElements;
            const thead = dataTable.querySelector('thead');
            const tbody = dataTable.querySelector('tbody');
            thead.innerHTML = ''; tbody.innerHTML = '';
            thead.innerHTML = `<tr>${dataHeaders.map(h => `<th class="capitalize">${h.replace(/_/g, ' ')}</th>`).join('')}</tr>`;
            appData.forEach(entry => {
                const row = tbody.insertRow();
                const categoryValue = entry[categoryColumnKey];
                const colorInfo = categoryColorMap[categoryValue] || { bg: '' };
                row.className = `text-sm align-top ${colorInfo.bg}`; 
                row.innerHTML = dataHeaders.map((header, index) => {
                    const value = entry[header] || 'N/A';
                    const noWrapClass = /time|code|room|type|mode|date/i.test(header) ? 'whitespace-nowrap' : '';
                    // NEW FEATURE: Intelligently bold important columns
                    const isImportant = /name|title/i.test(header) || (index === 0 && header !== categoryColumnKey);
                    const cellClass = `${noWrapClass} ${isImportant ? 'font-semibold text-slate-800 dark:text-slate-200' : ''}`;
                    
                    if (header === categoryColumnKey) {
                        const labelColorClass = categoryColorMap[value]?.label || 'cat-color-0';
                        return `<td class="whitespace-nowrap"><span class="category-label ${labelColorClass}">${value}</span></td>`;
                    }
                    return `<td class="${cellClass}">${value}</td>`;
                }).join('');
            });
            dataTableWrapper.classList.remove('hidden');
        }
        
        function switchView(view) {
            currentView = view;
            document.querySelectorAll('#view-buttons button').forEach(btn => {
                const isActive = btn.id === `view-${view}`;
                btn.classList.toggle('bg-blue-600', isActive);
                btn.classList.toggle('text-white', isActive);
                btn.classList.toggle('text-slate-600', !isActive);
                btn.classList.toggle('dark:text-slate-300', !isActive);
            });
            [allDOMElements.dataContainer, allDOMElements.dataTableWrapper].forEach(el => el.classList.add('hidden'));
            
            // Clear any lingering layout classes from dataContainer
            allDOMElements.dataContainer.className = '';

            if (view === 'card') renderCardView();
            else if (view === 'table') renderTableView();
        }

        // ===================================================================================
        // EXPORT & DOWNLOAD LOGIC
        // ===================================================================================

        async function captureFullElement(element) {
            if (!element) return null;
            
            const isDark = document.documentElement.classList.contains('dark');
            const tempStyleSheet = createCaptureStylesheet(isDark);
            
            const captureContainer = document.createElement('div');
            Object.assign(captureContainer.style, { position: 'absolute', left: '-9999px', top: '0', width: '1200px', height: 'auto', pointerEvents: 'none' });

            const clone = element.cloneNode(true);
            captureContainer.appendChild(clone);
            document.body.appendChild(captureContainer);
            
            await new Promise(resolve => setTimeout(resolve, 500)); 

            let canvas;
            try {
                canvas = await html2canvas(clone, {
                    scale: 2, backgroundColor: isDark ? '#0f172a' : '#f8fafc', useCORS: true,
                    scrollX: 0, scrollY: 0, windowWidth: captureContainer.scrollWidth, windowHeight: captureContainer.scrollHeight
                });
            } finally {
                document.body.removeChild(captureContainer);
                document.head.removeChild(tempStyleSheet);
            }
            return canvas;
        }

        function createCaptureStylesheet(isDark) { 
            const style = document.createElement('style'); 
            style.id = 'temp-capture-style'; 
            let css = `* { transition: none !important; animation: none !important; } td, p { word-break: break-word !important; white-space: normal !important; } td.whitespace-nowrap { white-space: nowrap !important; }`; 
            if (isDark) { css += ` body { background-color: #0f172a !important; } #data-container, #data-table-wrapper, #data-table, .class-card, li { background-color: #f8fafc !important; } .day-section h3, h3, .accordion-header h3 { color: #0f172a !important; } .class-card, li { border-color: #e5e7eb !important; } p, span, input, td, th, .accordion-content p { color: #334155 !important; } .font-semibold, .font-medium, .text-slate-900, .text-slate-800 { color: #1e293b !important; } .text-slate-500, .text-slate-600 { color: #64748b !important; } .cat-color-1 { background-color: #dcfce7 !important; color: #166534 !important; } .bg-cat-color-1, .card-cat-color-1 { background-color: #f0fdf4 !important; } .cat-color-2 { background-color: #dbeafe !important; color: #1e40af !important; } .bg-cat-color-2, .card-cat-color-2 { background-color: #eff6ff !important; } .cat-color-3 { background-color: #fee2e2 !important; color: #991b1b !important; } .bg-cat-color-3, .card-cat-color-3 { background-color: #fef2f2 !important; } .cat-color-4 { background-color: #cffafe !important; color: #0e7490 !important; } .bg-cat-color-4, .card-cat-color-4 { background-color: #ecfeff !important; } .cat-color-5 { background-color: #ede9fe !important; color: #5b21b6 !important; } .bg-cat-color-5, .card-cat-color-5 { background-color: #faf5ff !important; } .cat-color-6 { background-color: #ffedd5 !important; color: #9a3412 !important; } .bg-cat-color-6, .card-cat-color-6 { background-color: #fff7ed !important; } .cat-color-7 { background-color: #fce7f3 !important; color: #9d174d !important; } .bg-cat-color-7, .card-cat-color-7 { background-color: #fdf4ff !important; } .cat-color-0 { background-color: #f3f4f6 !important; color: #374151 !important; } .bg-cat-color-0, .card-cat-color-0 { background-color: #f9fafb !important; } #data-table th { background-color: #f9fafb !important; } #data-table th, #data-table td { border-bottom-color: #e5e7eb !important; } .category-label { border: 1px solid #e5e7eb !important; }`; } style.textContent = css; document.head.appendChild(style); return style; }
        
        function getActiveElementForCapture() { 
            return currentView === 'card' ? allDOMElements.dataContainer : allDOMElements.dataTableWrapper;
        }
        
        async function downloadAsPDF() { 
            const { jsPDF } = window.jspdf; 
            const element = getActiveElementForCapture(); 
            if (!element) return; 
            showStatus('preparing_pdf', 'success'); 
            const canvas = await captureFullElement(element); 
            if (!canvas) { return showStatus('PDF generation failed.', 'error'); }
            const imgData = canvas.toDataURL('image/png', 1.0); 
            const { width, height } = canvas; 
            const pdf = new jsPDF({ orientation: width > height ? 'l' : 'p', unit: 'px', format: [width, height] }); 
            pdf.addImage(imgData, 'PNG', 0, 0, width, height); 
            pdf.save('time-space-export.pdf'); 
        }
        
        async function downloadAsPNG() { 
            const element = getActiveElementForCapture(); 
            if (!element) return; 
            showStatus('preparing_png', 'success'); 
            const canvas = await captureFullElement(element); 
            if (!canvas) { return showStatus('PNG generation failed.', 'error'); }
            const link = document.createElement('a'); 
            link.download = 'time-space-export.png'; 
            link.href = canvas.toDataURL('image/png'); 
            link.click(); 
        }

        function downloadAsCSV() { 
            const csv = Papa.unparse(appData); 
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); 
            const link = document.createElement('a'); 
            link.href = URL.createObjectURL(blob); 
            link.download = 'time-space-export.csv'; 
            link.click(); 
        }
    
        // Start the application
        initializeApp();
    });
</script>

</body>
</html>

