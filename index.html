<!DOCTYPE html>
<!-- 'scroll-smooth' enables smooth scrolling for anchor links -->
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Space | AI Data Organizer</title>
    
    <!-- Libraries and Styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { fontFamily: { sans: ['Inter', 'sans-serif'] } } } }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.3/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .modal-overlay { position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center; background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); transition: opacity 0.5s ease; }
        .modal-content { transition: transform 0.5s ease, opacity 0.5s ease; }
        .modal-overlay.hidden { opacity: 0; pointer-events: none; }
        .modal-overlay.hidden .modal-content { transform: scale(0.95); opacity: 0; }
        #data-table tr.day-mon { background-color: #f0fdf4; border-left: 3px solid #4ade80; } .dark #data-table tr.day-mon { background-color: #164e3233; }
        #data-table tr.day-tue { background-color: #eff6ff; border-left: 3px solid #60a5fa; } .dark #data-table tr.day-tue { background-color: #1e3a8a33; }
        #data-table tr.day-wed { background-color: #fef2f2; border-left: 3px solid #f87171; } .dark #data-table tr.day-wed { background-color: #7f1d1d33; }
        #data-table tr.day-thu { background-color: #ecfeff; border-left: 3px solid #22d3ee; } .dark #data-table tr.day-thu { background-color: #164e6333; }
        #data-table tr.day-fri { background-color: #faf5ff; border-left: 3px solid #a78bfa; } .dark #data-table tr.day-fri { background-color: #4c1d9533; }
        #data-table tr.day-sat { background-color: #fff7ed; border-left: 3px solid #fb923c; } .dark #data-table tr.day-sat { background-color: #7c2d1233; }
        #data-table tr.day-sun { background-color: #fdf4ff; border-left: 3px solid #f472b6; } .dark #data-table tr.day-sun { background-color: #83184333; }
        .class-card.day-mon { background-color: #f0fdf4; border-left: 3px solid #4ade80; } .dark .class-card.day-mon { background-color: #164e3233; border-left-color: #4ade80;}
        .class-card.day-tue { background-color: #eff6ff; border-left: 3px solid #60a5fa; } .dark .class-card.day-tue { background-color: #1e3a8a33; border-left-color: #60a5fa;}
        .class-card.day-wed { background-color: #fef2f2; border-left: 3px solid #f87171; } .dark .class-card.day-wed { background-color: #7f1d1d33; border-left-color: #f87171;}
        .class-card.day-thu { background-color: #ecfeff; border-left: 3px solid #22d3ee; } .dark .class-card.day-thu { background-color: #164e6333; border-left-color: #22d3ee;}
        .class-card.day-fri { background-color: #faf5ff; border-left: 3px solid #a78bfa; } .dark .class-card.day-fri { background-color: #4c1d9533; border-left-color: #a78bfa;}
        .class-card.day-sat { background-color: #fff7ed; border-left: 3px solid #fb923c; } .dark .class-card.day-sat { background-color: #7c2d1233; border-left-color: #fb923c;}
        .class-card.day-sun { background-color: #fdf4ff; border-left: 3px solid #f472b6; } .dark .class-card.day-sun { background-color: #83184333; border-left-color: #f472b6;}
        .class-card { border: 1px solid #e5e7eb; transition: transform 0.2s ease, box-shadow 0.2s ease; cursor: grab; }
        .dark .class-card { border-color: #374151; }
        .class-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        .dark .class-card:hover { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15); }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        #data-table { width: 100%; border-collapse: collapse; }
        #data-table th, #data-table td { padding: 1rem 1.25rem; text-align: left; border-bottom: 1px solid #e5e7eb; }
        .dark #data-table th, .dark #data-table td { border-bottom-color: #374151; }
        #data-table th { background-color: #f9fafb; font-weight: 600; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: #4b5563; }
        .dark #data-table th { background-color: #1f2d37; color: #9ca3af; }
        .btn-animate { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.2s ease-in-out, filter 0.2s ease-in-out; }
        .btn-animate:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); filter: brightness(1.05); }
        .dark .btn-animate:hover { box-shadow: 0 4px 14px rgba(0,0,0,0.25); }
        .loader-overlay { position: fixed; inset: 0; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; background-color: rgba(248, 250, 252, 0.8); backdrop-filter: blur(4px); transition: opacity 0.5s ease-in-out; }
        .dark .loader-overlay { background-color: rgba(15, 23, 42, 0.8); }
        .loader-overlay.hidden { opacity: 0; pointer-events: none; }
        #scroll-to-top { position: fixed; bottom: 20px; right: 20px; opacity: 0; pointer-events: none; transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; transform: translateY(10px); z-index: 50;}
        #scroll-to-top.show { opacity: 1; pointer-events: auto; transform: translateY(0); }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200">

    <header class="sticky top-0 z-40 w-full bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm border-b border-slate-200 dark:border-slate-800 transition-transform duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="#" class="flex items-center space-x-2">
                    <svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" role="img" aria-label="Timetable Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C6.095 4.01 5.25 4.973 5.25 6.108V18.75c0 1.243.87 2.25 1.976 2.25h4.272a2.25 2.25 0 002.25-2.25V5.117A2.25 2.25 0 0011.25 3H9.75a2.25 2.25 0 00-2.25 2.25z" /></svg>
                    <span class="font-bold text-lg sm:text-xl text-slate-900 dark:text-white" data-translate-key="site_name">Time Space</span>
                </a>
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <nav class="hidden md:flex items-center space-x-6 text-sm font-medium text-slate-600 dark:text-slate-400">
                        <a href="#features" class="hover:text-blue-600 transition-colors" data-translate-key="nav_features">Features</a>
                        <a href="#portfolio" class="hover:text-blue-600 transition-colors" data-translate-key="nav_portfolio">Portfolio</a>
                    </nav>
                    <div class="h-6 w-px bg-slate-200 dark:bg-slate-700 hidden md:block"></div>
                    
                    <button id="admin-button" class="md:flex items-center justify-center h-9 px-3 rounded-lg text-slate-500 hover:bg-slate-200 dark:text-slate-400 dark:hover:bg-slate-800 transition-colors btn-animate text-sm font-semibold">Admin</button>

                    <button id="lang-toggle" class="h-9 w-9 flex items-center justify-center rounded-lg text-slate-500 hover:bg-slate-200 dark:text-slate-400 dark:hover:bg-slate-800 transition-colors btn-animate font-semibold text-xs"></button>
                    <button id="theme-toggle" class="h-9 w-9 flex items-center justify-center rounded-lg text-slate-500 hover:bg-slate-200 dark:text-slate-400 dark:hover:bg-slate-800 transition-colors btn-animate">
                        <svg class="h-5 w-5 block dark:hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" role="img" aria-label="Moon Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" /></svg>
                        <svg class="h-5 w-5 hidden dark:block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" role="img" aria-label="Sun Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" /></svg>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <div id="admin-modal" class="modal-overlay hidden">
        <div class="modal-content bg-white dark:bg-slate-800 w-full max-w-sm m-4 p-6 rounded-2xl shadow-xl">
            <h2 class="text-xl font-bold text-slate-800 dark:text-slate-200 text-center">Admin Access</h2>
            <p id="admin-error" class="text-sm text-red-500 text-center mt-2 h-4"></p>
            <div class="mt-4">
                <label for="admin-password" class="text-sm font-medium text-slate-600 dark:text-slate-400">Password</label>
                <input type="password" id="admin-password" class="mt-1 w-full px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div class="mt-6 flex gap-3">
                <button id="cancel-admin-login" class="btn-animate w-full px-4 py-2 text-sm font-semibold bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-500">Cancel</button>
                <button id="submit-admin-login" class="btn-animate w-full px-4 py-2 text-sm font-semibold bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700">Login</button>
            </div>
        </div>
    </div>
    
    <main>
        <section class="text-center py-16 sm:py-24 px-4 sm:px-6 lg:px-8">
            <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold tracking-tight text-slate-900 dark:text-white" data-translate-key="hero_title">Intelligent Data Organizer</h1>
            <p class="mt-4 max-w-2xl mx-auto text-lg text-slate-600 dark:text-slate-400" data-translate-key="hero_subtitle">Automatically analyze, structure, and visualize your data. Just upload any file to begin.</p>
            <div id="data-app" class="max-w-4xl mx-auto mt-12 bg-white dark:bg-slate-800 rounded-2xl shadow-lg overflow-hidden border border-slate-200 dark:border-slate-700 text-left">
                <div id="upload-section" class="p-4 sm:p-6 border-b border-slate-200 dark:border-slate-700 flex flex-col items-center">
                    <button id="upload-button" class="btn-animate w-full max-w-xs px-6 py-3 text-base font-semibold bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 dark:hover:bg-blue-500" data-translate-key="upload_button">Upload Your Data File</button>
                    <input type="file" id="file-upload" accept="image/*,application/pdf,.csv,.xlsx" class="hidden"/>
                    <p class="text-xs text-slate-500 dark:text-slate-400 mt-2" data-translate-key="upload_caption">Max file size: 10MB. Supports PDF, PNG, JPG, CSV, XLSX.</p>
                    <div id="status-message" class="mt-4 p-3 rounded-md text-sm text-center hidden w-full" role="alert"></div>
                </div>
                <div id="controls-area" class="hidden">
                    <div class="p-4 sm:p-6 border-b border-slate-200 dark:border-slate-700">
                        <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                            <label class="text-base font-semibold text-slate-800 dark:text-slate-200 whitespace-nowrap" data-translate-key="controls_title">✨ AI Analysis Complete — Here’s Your Interactive Data!</label>
                            <div class="flex items-center gap-2">
                                <div id="view-buttons" class="flex-shrink-0 flex items-center space-x-2 bg-slate-100 dark:bg-slate-900 p-1 rounded-md">
                                    <button id="view-card" class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors btn-animate" data-translate-key="card_view">Card View</button>
                                    <button id="view-table" class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors btn-animate" data-translate-key="table_view">Table View</button>
                                </div>
                                <button id="clear-data" class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors btn-animate bg-red-500 text-white hover:bg-red-600 dark:bg-red-600 dark:hover:bg-red-700" data-translate-key="clear_button">Clear</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="results-area" class="bg-slate-50 dark:bg-slate-900/50 p-4 sm:p-6">
                    <div id="data-container" class="space-y-4"></div>
                    <div id="data-table-wrapper" class="overflow-x-auto rounded-lg border border-slate-200 dark:border-slate-700 hidden">
                        <table id="data-table">
                            <thead></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div id="download-options" class="mt-6 flex flex-wrap gap-3 hidden">
                        <button id="download-pdf" class="btn-animate px-4 py-2 text-sm font-medium bg-blue-600 text-white rounded-md shadow-sm" data-translate-key="download_pdf">Download PDF</button>
                        <button id="download-png" class="btn-animate px-4 py-2 text-sm font-medium bg-emerald-600 text-white rounded-md shadow-sm" data-translate-key="download_png">Download PNG</button>
                        <button id="download-csv" class="btn-animate px-4 py-2 text-sm font-medium bg-slate-600 text-white rounded-md shadow-sm" data-translate-key="download_csv">Download CSV</button>
                        <button id="download-xlsx" class="btn-animate px-4 py-2 text-sm font-medium bg-slate-600 text-white rounded-md shadow-sm" data-translate-key="download_xlsx">Download XLSX</button>
                    </div>
                </div>
            </div>
        </section>
        <section id="features" class="py-16 sm:py-24 bg-white dark:bg-slate-800">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h2 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white sm:text-4xl" data-translate-key="features_title">Powerful Features, Simple Interface</h2>
                    <p class="mt-4 text-lg text-slate-600 dark:text-slate-400" data-translate-key="features_subtitle">Everything you need to manage your data efficiently.</p>
                </div>
                <div class="mt-12 grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center bg-blue-100 dark:bg-blue-900/50 rounded-lg text-blue-600 dark:text-blue-400"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" role="img" aria-label="Cloud Upload Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l-3 3m3-3l3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" /></svg></div>
                        <div>
                            <h3 class="text-lg font-semibold text-slate-900 dark:text-white" data-translate-key="feature1_title">Smart Data Extraction</h3>
                            <p class="mt-1 text-slate-600 dark:text-slate-400" data-translate-key="feature1_desc">Intelligently analyzes any data structure from images, PDFs, CSV, and Excel files.</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center bg-blue-100 dark:bg-blue-900/50 rounded-lg text-blue-600 dark:text-blue-400"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" role="img" aria-label="Layout Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25A2.25 2.25 0 0113.5 8.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" /></svg></div>
                        <div>
                            <h3 class="text-lg font-semibold text-slate-900 dark:text-white" data-translate-key="feature2_title">Multiple View Options</h3>
                            <p class="mt-1 text-slate-600 dark:text-slate-400" data-translate-key="feature2_desc">View your information as a table, cards, or a simple checklist.</p>
                        </div>
                    </div>
                    <div class="flex items-start space-x-4">
                        <div class="flex-shrink-0 h-12 w-12 flex items-center justify-center bg-blue-100 dark:bg-blue-900/50 rounded-lg text-blue-600 dark:text-blue-400"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6" role="img" aria-label="Download Icon"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg></div>
                        <div>
                            <h3 class="text-lg font-semibold text-slate-900 dark:text-white" data-translate-key="feature3_title">Multiple Export Options</h3>
                            <p class="mt-1 text-slate-600 dark:text-slate-400" data-translate-key="feature3_desc">Download your organized data as a PDF, PNG, CSV, or XLSX file.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <section id="portfolio" class="py-16 sm:py-24">
            <div class="max-w-3xl mx-auto text-center px-4 sm:px-6 lg:px-8">
                <h2 class="text-3xl font-bold tracking-tight text-slate-900 dark:text-white sm:text-4xl" data-translate-key="portfolio_title">Have a Look</h2>
                <p class="mt-4 text-lg text-slate-600 dark:text-slate-400" data-translate-key="portfolio_desc">Interested in seeing more of my work? Visit my portfolio to explore other projects.</p>
                <div class="mt-8"><a href="https://muhammad-owais-1947.github.io/portfolio/" target="_blank" rel="noopener noreferrer" class="btn-animate inline-block px-8 py-3 text-base font-semibold bg-blue-600 text-white rounded-lg shadow-md" data-translate-key="portfolio_button">Check Out What I’ve Built</a></div>
            </div>
        </section>
    </main>
    <footer class="bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-slate-500 dark:text-slate-400">
            <div class="flex flex-col items-center gap-4">
                <a href="https://mail.google.com/mail/?view=cm&fs=1&to=professional.OTS@Gmail.com&su=Feedback%20for%20AI%20Data%20Organizer&body=Hello,%0D%0A%0D%0AI'd like to share some feedback:%0D%0A%0D%0A..." target="_blank" rel="noopener noreferrer" class="btn-animate inline-flex items-center justify-center px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-full text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 font-medium" title="Share Feedback"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828a4.5 4.5 0 01-6.364 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> <span>Share Feedback</span></a>
                <p data-translate-key="footer_text">&copy; 2025 Time Space. All rights reserved. Crafted with Code & Coffee ☕ — Muhammad Owais.</p>
            </div>
        </div>
    </footer>
    <button id="scroll-to-top" class="btn-animate h-12 w-12 rounded-full bg-blue-600 text-white shadow-lg flex items-center justify-center hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600" aria-label="Scroll to top"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" /></svg></button>

<script type="module">
    // --- CONFIGURATION ---
    // PASTE your Cloudflare Worker URL here. It must start with https://
    const SECURE_API_URL = "security.anonymoushacker151122.workers.dev";
    
    // Wrapped all code in DOMContentLoaded to prevent timing errors
    document.addEventListener('DOMContentLoaded', () => {

        // --- GLOBAL STATE & CONSTANTS ---
        const MAX_FILE_SIZE = 10 * 1024 * 1024;
        const USER_UPLOAD_LIMIT = 5; // Per hour for non-admins
        const UPLOAD_LIMIT_HOURS = 1;
        let isAdmin = false; 
        let appData = [];
        let dataHeaders = [];
        let dayColumnKey = '';
        let currentView = 'card';
        const DAY_CLASSES = {'Monday': 'day-mon', 'Mon': 'day-mon', 'Peer': 'day-mon', 'Tuesday': 'day-tue', 'Tue': 'day-tue', 'Mangal': 'day-tue', 'Wednesday': 'day-wed', 'Wed': 'day-wed', 'Budh': 'day-wed', 'Thursday': 'day-thu', 'Thu': 'day-thu', 'Jumerat': 'day-thu', 'Friday': 'day-fri', 'Fri': 'day-fri', 'Juma': 'day-fri', 'Saturday': 'day-sat', 'Sat': 'day-sat', 'Hafta': 'day-sat', 'Sunday': 'day-sun', 'Sun': 'day-sun', 'Itwar': 'day-sun'};
        const defaultTimetableData = [ /* Default data is unchanged */ ];

        // --- DOM ELEMENT SELECTORS ---
        const allDOMElements = {
            pageLoader: document.getElementById('page-loader'),
            processingLoader: document.getElementById('processing-loader'),
            statusMessage: document.getElementById('status-message'),
            dataContainer: document.getElementById('data-container'),
            dataTableWrapper: document.getElementById('data-table-wrapper'),
            dataTable: document.getElementById('data-table'),
            controlsArea: document.getElementById('controls-area'),
            downloadOptions: document.getElementById('download-options'),
            fileUpload: document.getElementById('file-upload'),
            uploadButton: document.getElementById('upload-button'),
            clearDataBtn: document.getElementById('clear-data'),
            scrollToTopBtn: document.getElementById('scroll-to-top'),
            themeToggle: document.getElementById('theme-toggle'),
            langToggle: document.getElementById('lang-toggle'),
            adminButton: document.getElementById('admin-button'),
            adminModal: document.getElementById('admin-modal'),
            adminError: document.getElementById('admin-error'),
            adminPasswordInput: document.getElementById('admin-password'),
            cancelAdminLogin: document.getElementById('cancel-admin-login'),
            submitAdminLogin: document.getElementById('submit-admin-login'),
        };
        
        // --- TRANSLATIONS (unchanged) ---
        const translations = { en: { site_name: "Time Space", nav_features: "Features", nav_portfolio: "Portfolio", hero_title: "Intelligent Data Organizer", hero_subtitle: "Automatically analyze, structure, and visualize your data. Just upload any file to begin.", upload_button: "Upload Your Data File", upload_caption: "Max file size: 10MB. Supports PDF, PNG, JPG, CSV, XLSX.", controls_title: "✨ AI Analysis Complete — Here’s Your Interactive Data!", card_view: "Card View", table_view: "Table View", list_view: "List View", clear_button: "Clear", download_pdf: "Download PDF", download_png: "Download PNG", download_csv: "Download CSV", download_xlsx: "Download XLSX", features_title: "Powerful Features, Simple Interface", features_subtitle: "Everything you need to manage your data efficiently.", feature1_title: "Smart Data Extraction", feature1_desc: "Intelligently analyzes any data structure from images, PDFs, CSV, and Excel files.", feature2_title: "Multiple View Options", feature2_desc: "View your information as a table, cards, or a simple checklist.", feature3_title: "Multiple Export Options", feature3_desc: "Download your organized data as a PDF, PNG, CSV, or XLSX file.", portfolio_title: "Have a Look", portfolio_desc: "Interested in seeing more of my work? Visit my portfolio to explore other projects.", portfolio_button: "Check Out What I’ve Built", footer_text: "© 2025 Time Space. All rights reserved. Crafted with Code & Coffee ☕ — Muhammad Owais.", loading_analyzer: "Loading Time Space...", analyzing: "Making magic behind the scenes...", welcome_message: "Welcome to Time Space! The default timetable is loaded. Upload a file to see the magic.", schedule_cleared: "Data cleared. Showing default timetable.", file_uploaded: "File upload successful, processing...", preparing_pdf: "Generating PDF...", preparing_png: "Generating PNG...", no_data: "No data to display.", unsupported_file_type: "Unsupported file type." }, ur: { site_name: "Time Space", nav_features: "Khususiyat", nav_portfolio: "Portfolio", hero_title: "Aqalmand Data Organizer", hero_subtitle: "Apne data ko khud bakhud tajzia, tarteeb, aur visualize karein. Shuru karne ke liye bas koi file upload karein.", upload_button: "Apni Data File Upload Karein", upload_caption: "Max file size: 10MB. PDF, PNG, JPG, CSV, XLSX support hai.", controls_title: "✨ AI Tajzia Mukammal — Aapka Interactive Data Hazir Hai!", card_view: "Card View", table_view: "Table View", list_view: "List View", clear_button: "Saaf Karein", download_pdf: "PDF Download Karein", download_png: "PNG Download Karein", download_csv: "CSV Download Karein", download_xlsx: "XLSX Download Karein", features_title: "Zabast Khususiyat, Asan Interface", features_subtitle: "Apne data ko muassar tareeqe se manage karne ke liye har cheez.", feature1_title: "Smart Data Nikalna", feature1_desc: "Tasaveer, PDFs, CSV, aur Excel files se kisi bhi data structure ka aqalmandana tajzia karta hai.", feature2_title: "Mukhtalif Views", feature2_desc: "Apni maloomat ko table, cards, ya-simple checklist ke tor par dekhein.", feature3_title: "Kayi Export Options", feature3_desc: "Apna tarteeb shuda data PDF, PNG, CSV, ya XLSX file ke tor par download karein.", portfolio_title: "Mera Kaam Dekhein", portfolio_desc: "Mera mazeed kaam dekhne mein dilchaspi hai? Doosre projects ke liye mera portfolio visit karein.", portfolio_button: "Mera Kaam Dekhein", footer_text: "© 2025 Time Space. Tamam huqooq mehfooz hain. Code & Coffee se banaya ☕ — Muhammad Owais.", loading_analyzer: "Time Space Load ho raha hai...", analyzing: "Parde ke peeche jadu ho raha hai...", welcome_message: "Time Space mein khush amdeed! Default timetable load ho gaya hai. Jadu dekhne ke liye file upload karein.", schedule_cleared: "Data saaf ho gaya. Default timetable dikhaya ja raha hai.", file_uploaded: "File upload ho gayi. Processing ho rahi hai...", preparing_pdf: "PDF tayar ho raha hai...", preparing_png: "PNG tayar ho raha hai...", no_data: "Dikhanay ke liye koi data nahi.", unsupported_file_type: "Na-qabil e qubool file type." } };
        let currentLang = 'en';
        function getText(key, lang = currentLang) { return translations[lang]?.[key] || key; }

        // --- INITIALIZATION ---
        function initializeApp() {
            setupEventListeners();
            const savedLang = localStorage.getItem('language') || 'en';
            setLanguage(savedLang);
            if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            }
            if (allDOMElements.pageLoader) {
                setTimeout(() => { allDOMElements.pageLoader.classList.add('hidden'); }, 500);
            }
            appData = JSON.parse(JSON.stringify(defaultTimetableData));
            prepareAndRender('card');
            showStatus('welcome_message', 'success');
        }

        // --- EVENT LISTENERS SETUP ---
        function setupEventListeners() {
            allDOMElements.themeToggle.addEventListener('click', () => { document.documentElement.classList.toggle('dark'); localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light'); });
            allDOMElements.langToggle.addEventListener('click', () => setLanguage(currentLang === 'en' ? 'ur' : 'en'));
            allDOMElements.uploadButton.addEventListener('click', () => allDOMElements.fileUpload.click());
            allDOMElements.fileUpload.addEventListener('change', handleFileUpload);
            allDOMElements.clearDataBtn.addEventListener('click', clearData);

            allDOMElements.adminButton.addEventListener('click', () => {
                if (isAdmin) {
                    isAdmin = false;
                    updateAdminButtonUI();
                } else {
                    allDOMElements.adminModal.classList.remove('hidden');
                    allDOMElements.adminPasswordInput.focus();
                }
            });
            allDOMElements.cancelAdminLogin.addEventListener('click', () => {
                 allDOMElements.adminModal.classList.add('hidden');
                 allDOMElements.adminError.textContent = '';
                 allDOMElements.adminPasswordInput.value = '';
            });
            allDOMElements.submitAdminLogin.addEventListener('click', handleAdminLogin);
            allDOMElements.adminPasswordInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') handleAdminLogin(); });
        }

        // --- ADMIN LOGIN ---
        async function handleAdminLogin() {
            const enteredPassword = allDOMElements.adminPasswordInput.value;
            allDOMElements.adminError.textContent = 'Verifying...';
            allDOMElements.submitAdminLogin.disabled = true;

            try {
                // Ensure the URL is absolute
                if (!SECURE_API_URL.startsWith('http')) {
                    throw new Error("Worker URL is not configured correctly. It must start with https://");
                }

                const response = await fetch(SECURE_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'verifyAdmin',
                        password: enteredPassword
                    })
                });

                if (response.status === 401) throw new Error("Incorrect password.");
                if (!response.ok) {
                    const err = await response.json().catch(() => ({ error: `Network error: ${response.statusText}` }));
                    throw new Error(err.error);
                }
                
                const result = await response.json();
                if (result.success) {
                    isAdmin = true;
                    allDOMElements.cancelAdminLogin.click();
                } else {
                     throw new Error("Incorrect password.");
                }
            } catch (error) {
                isAdmin = false;
                allDOMElements.adminError.textContent = error.message;
                console.error("Admin login error:", error);
            } finally {
                allDOMElements.submitAdminLogin.disabled = false;
                updateAdminButtonUI();
            }
        }

        function updateAdminButtonUI() {
            if (isAdmin) {
                allDOMElements.adminButton.textContent = 'Admin Mode ✅';
                allDOMElements.adminButton.classList.add('text-green-500', 'dark:text-green-400');
                showStatus('Admin mode activated. Upload limit removed.', 'success');
            } else {
                allDOMElements.adminButton.textContent = 'Admin';
                allDOMElements.adminButton.classList.remove('text-green-500', 'dark:text-green-400');
            }
        }
        
        // --- CORE APP LOGIC ---
        function setLanguage(lang) { /* ... */ }
        function showStatus(messageKey, type) { /* ... */ }

        // --- FILE UPLOAD & RATE LIMITING ---
        function checkUploadLimit() {
            if (isAdmin) return true;
            const now = new Date().getTime();
            const oneHourAgo = now - (UPLOAD_LIMIT_HOURS * 60 * 60 * 1000);
            const uploads = JSON.parse(localStorage.getItem('userUploads') || '[]');
            const recentUploads = uploads.filter(timestamp => timestamp > oneHourAgo);
            localStorage.setItem('userUploads', JSON.stringify(recentUploads));
            return recentUploads.length < USER_UPLOAD_LIMIT;
        }

        function recordUpload() {
            if (isAdmin) return;
            const uploads = JSON.parse(localStorage.getItem('userUploads') || '[]');
            uploads.push(new Date().getTime());
            localStorage.setItem('userUploads', JSON.stringify(uploads));
        }

        async function handleFileUpload(event) {
            if (!checkUploadLimit()) {
                showStatus("Upload limit (5 per hour) reached. Please try again later or enable Admin Mode for unlimited uploads.", "error");
                return;
            }
            const file = event.target.files[0];
            if (!file) return;
            allDOMElements.processingLoader.classList.remove('hidden');
            showStatus('file_uploaded', 'success');
            try {
                const fileExt = file.name.split('.').pop().toLowerCase();
                const data = (fileExt === 'csv') ? await parseCSV(file) : (fileExt === 'xlsx') ? await parseXLSX(file) : await fileToBase64(file);
                const mimeType = (fileExt === 'csv' || fileExt === 'xlsx') ? 'application/json' : file.type;
                const dataForAI = (mimeType === 'application/json') ? JSON.stringify(data) : data;
                await callSmartAI(mimeType, dataForAI);
                recordUpload();
            } catch (error) {
                 console.error('Processing error:', error);
                 showStatus(error.message, 'error');
                 allDOMElements.processingLoader.classList.add('hidden');
            }
        }

        // --- SECURE AI DATA ANALYSIS ---
        async function callSmartAI(mimeType, dataForAI) {
            if (SECURE_API_URL === "PASTE_YOUR_CLOUDFLARE_WORKER_URL_HERE" || !SECURE_API_URL.startsWith('http')) {
                 showStatus("API endpoint is not configured by the developer.", "error");
                 throw new Error("API URL not configured.");
            }
            try {
                const response = await fetch(SECURE_API_URL, { 
                    method: 'POST', 
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify({ action: 'analyzeData', mimeType, dataForAI }) 
                });
                if (!response.ok) {
                    const errorResult = await response.json().catch(() => ({error: `API error: ${response.statusText}`}));
                    throw new Error(errorResult.error);
                }
                const parsedData = await response.json();
                if (!Array.isArray(parsedData) || parsedData.length === 0) {
                    throw new Error("AI analysis resulted in empty or invalid data.");
                }
                appData = parsedData;
                prepareAndRender();
            } catch (error) {
                console.error('AI Error:', error.message);
                showStatus(error.message, 'error');
                throw error;
            } finally {
                 allDOMElements.processingLoader.classList.add('hidden');
            }
        }
        
        // --- The rest of your UI and download logic (unchanged) ---
        function fileToBase64(file) { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.onload = () => resolve(reader.result.split(',')[1]); reader.onerror = reject; reader.readAsDataURL(file); }); }
        function parseCSV(file) { return new Promise((resolve, reject) => Papa.parse(file, { complete: res => res.errors.length ? reject(res.errors[0]) : resolve(structureParsedData(res.data)), error: reject, skipEmptyLines: true })); }
        function parseXLSX(file) { return new Promise((resolve, reject) => { const reader = new FileReader(); reader.onload = e => { try { const book = XLSX.read(e.target.result, { type: 'binary' }); resolve(structureParsedData(XLSX.utils.sheet_to_json(book.Sheets[book.SheetNames[0]], { header: 1 }))); } catch (err) { reject(err); } }; reader.onerror = reject; reader.readAsBinaryString(file); }); }
        function structureParsedData(data) { if (data.length < 2) return []; const headers = data[0]; return data.slice(1).map(row => headers.reduce((obj, h, i) => ({ ...obj, [h]: (row[i] || '').toString().trim() }), {})).filter(entry => Object.values(entry).some(val => val));}
        function isImageUrl(url) { return typeof url === 'string' && /\.(jpeg|jpg|gif|png|svg|webp)$/i.test(url); }
        function findDayColumnKey(headers) { return headers.find(h => ['day', 'weekday', 'jour', 'din'].includes(h.toLowerCase())) || ''; }
        function clearData() { appData = JSON.parse(JSON.stringify(defaultTimetableData)); prepareAndRender('card'); showStatus('schedule_cleared', 'success'); }
        function prepareAndRender(defaultView = 'card') { allDOMElements.controlsArea.classList.remove('hidden'); allDOMElements.downloadOptions.classList.remove('hidden'); if (!appData || appData.length === 0) { allDOMElements.dataContainer.innerHTML = `<p class="text-center text-slate-500 p-8">${getText('no_data')}</p>`; return; } dataHeaders = Object.keys(appData[0]); dayColumnKey = findDayColumnKey(dataHeaders); switchView(dayColumnKey ? defaultView : 'table'); }
        function renderCardView() { const { dataContainer } = allDOMElements; dataContainer.innerHTML = ''; const columns = dataHeaders.length; let gridClass = 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-3'; if (columns > 6) { gridClass = 'grid-cols-1 sm:grid-cols-2'; } else if (columns > 4) { gridClass = 'grid-cols-1 sm:grid-cols-2 lg:grid-cols-2'; } const container = document.createElement('div'); container.className = `grid ${gridClass} gap-4`; appData.forEach(entry => { let cardContent = ''; dataHeaders.forEach((header, i) => { const value = entry[header] || 'N/A'; const displayValue = isImageUrl(value) ? `<img src="${value}" alt="User content" class="mt-1 w-full h-auto max-h-48 object-contain rounded-md">` : `<span class="break-words">${value}</span>`; cardContent += `<p class="${i < 2 ? 'font-semibold text-slate-900 dark:text-white' : 'text-slate-500 dark:text-slate-400 text-sm'} capitalize">${header}: ${displayValue}</p>`; }); const dayClass = dayColumnKey ? (DAY_CLASSES[entry[dayColumnKey]] || '') : ''; container.innerHTML += `<div class="class-card ${dayClass} p-4 rounded-lg"><div class="flex flex-col gap-1">${cardContent}</div></div>`; }); dataContainer.appendChild(container); dataContainer.classList.remove('hidden'); }
        function renderTableView() { const { dataTable } = allDOMElements; const thead = dataTable.querySelector('thead'); const tbody = dataTable.querySelector('tbody'); thead.innerHTML = ''; tbody.innerHTML = ''; thead.innerHTML = `<tr>${dataHeaders.map(h => `<th class="capitalize">${h}</th>`).join('')}</tr>`; appData.forEach(entry => { const row = tbody.insertRow(); row.className = `${(dayColumnKey && DAY_CLASSES[entry[dayColumnKey]]) || ''} text-sm`; row.innerHTML = dataHeaders.map(header => { const value = entry[header] || 'N/A'; return isImageUrl(value) ? `<td><img src="${value}" alt="User content" class="w-16 h-16 object-cover rounded-md"></td>` : `<td class="whitespace-nowrap">${value}</td>`; }).join(''); }); allDOMElements.dataTableWrapper.classList.remove('hidden'); }
        function switchView(view) { currentView = view; document.querySelectorAll('#view-buttons button').forEach(btn => { const isActive = btn.id === `view-${view}`; btn.classList.toggle('bg-blue-600', isActive); btn.classList.toggle('text-white', isActive); btn.classList.toggle('text-slate-600', !isActive); btn.classList.toggle('dark:text-slate-300', !isActive); }); [allDOMElements.dataContainer, allDOMElements.dataTableWrapper].forEach(el => el.classList.add('hidden')); if (view === 'card') renderCardView(); else if (view === 'table') renderTableView(); }
        async function captureFullElement(element) {if (!element) return null; const isDark = document.documentElement.classList.contains('dark'); const tempStyleSheet = createCaptureStylesheet(isDark); const captureContainer = document.createElement('div'); captureContainer.style.position = 'absolute'; captureContainer.style.left = '-9999px'; captureContainer.style.top = '0'; captureContainer.style.width = '1200px'; captureContainer.style.height = 'auto'; captureContainer.style.pointerEvents = 'none'; const originalParent = element.parentNode; const nextSibling = element.nextSibling; captureContainer.appendChild(element); document.body.appendChild(captureContainer); await new Promise(resolve => setTimeout(resolve, 300)); let canvas; try { canvas = await html2canvas(element, { scale: 3, backgroundColor: '#f8fafc', useCORS: true, scrollX: 0, scrollY: 0 }); } finally { if (nextSibling) { originalParent.insertBefore(element, nextSibling); } else { originalParent.appendChild(element); } document.body.removeChild(captureContainer); document.head.removeChild(tempStyleSheet); } return canvas; }
        function createCaptureStylesheet(isDark) { const style = document.createElement('style'); style.id = 'temp-capture-style'; let css = `* { transition: none !important; animation: none !important; }`; if (isDark) { css += ` #data-container, #data-table-wrapper, #data-table, .class-card, li { background-color: #f8fafc !important; } .day-section h3, h3 { color: #1e2d3b !important; } .class-card, li { border-color: #e5e7eb !important; } p, span, input, td, th { color: #334155 !important; } .font-semibold, .font-medium, .text-slate-900, .text-slate-800 { color: #1e2d3b !important; } .text-slate-500, .text-slate-600 { color: #64748b !important; } .class-card.day-mon, li.day-mon, tr.day-mon { background-color: #f0fdf4 !important; } .class-card.day-tue, li.day-tue, tr.day-tue { background-color: #eff6ff !important; } .class-card.day-wed, li.day-wed, tr.day-wed { background-color: #fef2f2 !important; } .class-card.day-thu, li.day-thu, tr.day-thu { background-color: #ecfeff !important; } .class-card.day-fri, li.day-fri, tr.day-fri { background-color: #faf5ff !important; } .class-card.day-sat, li.day-sat, tr.day-sat { background-color: #fff7ed !important; } .class-card.day-sun, li.day-sun, tr.day-sun { background-color: #fdf4ff !important; } #data-table th { background-color: #f9fafb !important; } #data-table th, #data-table td { border-bottom-color: #e5e7eb !important; }`; } style.textContent = css; document.head.appendChild(style); return style; }
        function getActiveElementForCapture() { switch (currentView) { case 'card': case 'list': return allDOMElements.dataContainer; case 'table': return allDOMElements.dataTableWrapper; default: return null; } }
        async function downloadAsPDF() { const { jsPDF } = window.jspdf; const element = getActiveElementForCapture(); if (!element) return; showStatus('preparing_pdf', 'success'); try { const canvas = await captureFullElement(element); if (!canvas) throw new Error("Capture failed."); const imgData = canvas.toDataURL('image/png'); const { width, height } = canvas; const pdf = new jsPDF({ orientation: width > height ? 'l' : 'p', unit: 'px', format: [width, height] }); pdf.addImage(imgData, 'PNG', 0, 0, width, height); pdf.save('time-space-export.pdf'); } catch (error) { console.error("PDF Export Error:", error); showStatus(error.message, 'error'); } }
        async function downloadAsPNG() { const element = getActiveElementForCapture(); if (!element) return; showStatus('preparing_png', 'success'); try { const canvas = await captureFullElement(element); if (!canvas) throw new Error("Capture failed."); const link = document.createElement('a'); link.download = 'time-space-export.png'; link.href = canvas.toDataURL('image/png'); link.click(); } catch (error) { console.error("PNG Export Error:", error); showStatus(error.message, 'error'); } }
        function downloadAsCSV() { const csv = Papa.unparse(appData); const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' }); const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = 'time-space-export.csv'; link.click(); }
        function downloadAsXLSX() { const ws = XLSX.utils.json_to_sheet(appData); const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, 'Data'); XLSX.writeFile(wb, 'time-space-export.xlsx'); }

        // Start the application
        initializeApp();
    });
</script>

</body>
</html>

